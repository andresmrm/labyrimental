{"version":3,"sources":["webpack:///app.js","webpack:///./src/index.js","webpack:///./src/store.js","webpack:///./src/utils.js","webpack:///./src/vision.js","webpack:///./src/audio.js","webpack:///./src/createAudios.js","webpack:///./src/game.js","webpack:///./src/interface.js","webpack:///./src/movement.js","webpack:///./assets/map/map.js","webpack:///./src/input.js","webpack:///./src/levels.js","webpack:///./src/loader.js","webpack:///./src/randPos.js","webpack:///./src/pages/cantsee.html","webpack:///./src/pages/controls.html","webpack:///./src/pages/credits.html","webpack:///./src/pages/end1.html","webpack:///./src/pages/history.html","webpack:///./src/pages/instrorstart.html","webpack:///./src/pages/instructions.html","webpack:///./src/pages/l2end1.html","webpack:///./src/pages/l2end2.html","webpack:///./src/pages/l2end3.html","webpack:///./src/pages/l2intro.html","webpack:///./src/pages/l2intro2.html","webpack:///./src/pages/l2intro3.html","webpack:///./src/pages/l2intro3a.html","webpack:///./src/pages/l2intro4.html","webpack:///./src/pages/l2intro5.html","webpack:///./src/pages/lost2.html","webpack:///./src/pages/mainmenu.html"],"names":["webpackJsonp","module","exports","__webpack_require__","preload","_storeJs","state","game","stage","disableVisibilityChange","load","audio","create","song","add","sound","setDecodedCallback","_gameJs","playSong","this","createdSounds","_loaderJs","mainLoad","update","Phaser","Game","AUTO","Object","defineProperty","value","shrines","water","position","walkablePos","soundName","gain","color","earth","air","fire","level","direction","followed","presences","darkPresence","power","filters","tint","loadingVision","playIntro","currentSong","window","s","randInt","x","Math","floor","random","equalArrays","a1","a2","equal","i","textToPos","t","split","map","parseInt","posToText","pos","join","posDirToText","posDist","p1","p2","sqrt","pow","rotLeft","dir","directions","indexOf","rotRight","rot180","getBounds","obj","y","width","height","setVision","isResize","arguments","length","undefined","img","destroy","image","_utilsJs","layers","back","r","min","scale","setTo","bounds","key","round","_interfaceJs","setInterfaceBounds","onTap","inputEnabled","events","onInputUp","onSetVision","addEffect","alpha","effect","graphics","beginFill","drawRect","endFill","front","loadVision","cache","checkImageKey","onFileComplete","start","resize","setGameSize","innerWidth","innerHeight","addEventListener","time","setListenerPos","context","listener","setPosition","audioMult","setAudioOri","_direction","_slicedToArray","z","setOrientation","setPannerPos","panner","_pos","addSound","soundGain","createPanner","panningModel","distanceModel","refDistance","maxDistance","rolloffFactor","gainNode","disconnect","connect","volume","createGain","masterGain","loop","play","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","Symbol","iterator","next","done","push","err","Array","isArray","TypeError","createCommonAudios","steps","allowMultiple","addMarker","assign","harp","harpStart","button","magic","magicNo","magicRequest","magicArrived","darkSpell","darkSong","rarr","end2","createPositionedAudios","k","shrine","_audioJs","presence","changePresenceSoundGain","darkPres","presenceName","mult","name","fadeInTime","stop","fadeIn","stopSong","fadeOutTime","isPlaying","fadeOut","touchedDarkPresence","won","lost","includes","_visionJs","tween","to","checkFollowPresence","checkInShrine","interact","isInPresence","arrived","_createAudiosJs","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","p","_movementJs","changePresencePos","isInShrine","presenceArrived","newPower","setPower","splice","keys","reduce","c","onStop","removeAll","replace","tweenTo","tweenBack","chain","onComplete","playButtonSound","cheatLevel1","cheatLevel2","cheats","l1","l2","getDiv","outer","document","getElementById","val","index","style","padding","openPage","playSound","showInterface","text","pages","innerHTML","scrollTo","inter","zIndex","opacity","pointerEvents","hideInterface","hideLoadingScreen","el","parentNode","removeChild","mainmenu","controls","instructions","instrorstart","history","cantsee","end1","l2intro","l2intro2","l2intro3","l2intro3a","l2intro4","l2intro5","lost2","l2end1","l2end2","l2end3","credits","_interopRequireDefault","__esModule","default","tryChangePos","newPos","_assetsMapMapJs2","oldPos","posSetter","tweenPos","changeDarkPresencePos","playerPos","fTouched","move","event","moved","rotated","rotatePlayer","onMoved","type","walk","store","extraName","_oldPos","ox","oy","oz","_newPos","nx","ny","nz","updateFunc","onUpdateCallback","initPlayerPos","_assetsMapMapJs","e","w","n","4_0_0","6_6_0","2_6_0","3_7_0","8_3_0","1_2_0","3_0_0","0_2_0","-1_7_0","3_4_0","6_7_0","6_4_0","1_8_0","1_0_0","8_6_0","6_3_0","4_4_0","8_8_0","6_5_0","5_1_0","3_2_0","0_7_0","7_0_0","4_3_0","7_7_0","2_2_0","7_2_0","4_1_0","1_1_0","2_1_0","2_5_0","8_2_0","2_4_0","8_4_0","0_5_0","1_4_0","6_1_0","0_1_0","5_2_0","1_7_0","1_5_0","2_3_0","3_6_0","4_6_0","0_8_0","5_7_0","9_0_0","3_1_0","8_9_0","4_8_0","5_4_0","0_0_0","4_2_0","3_8_0","5_0_0","7_6_0","2_8_0","8_7_0","2_7_0","0_-1_0","0_4_0","6_0_0","4_7_0","7_4_0","1_6_0","6_2_0","5_8_0","0_3_0","2_0_0","5_6_0","7_8_0","8_1_0","4_5_0","0_6_0","8_0_0","8_5_0","1_3_0","7_1_0","6_8_0","initKeyboardInput","fMove","fInteract","_this","cursors","input","keyboard","addKey","Keyboard","onDown","SPACEBAR","initMouseInput","manager","pointer","_getBounds","_getBounds2","ix","iy","iw","ih","ty","by","lx","rx","fadeGame","fadeTime","wonLevel1","introLevel1","startLevel","introLevel2","localStorage","lastLevel","_randPosJs","randomizePresencePositions","fadeOutPositionalSounds","wonLevel2","lostLevel2","darkPresencePhrases","loadLevel","intro","createdFilters","gray","pickLevel","onLoadComplete","mainInit","script","firstImg","console","log","backgroundColor","group","filter","_inputJs","getItem","_levelsJs","player_pos","possible_pos","array_pos","deleteCube","failed","remainingAttempts","remaining_pos","center","radius","_center","xc","yc","zc","j"],"mappings":"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","file":"app.js","sourcesContent":["webpackJsonp([1],[\n/* 0 */\n/*!**********************!*\\\n  !*** ./src/index.js ***!\n  \\**********************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _loaderJs = __webpack_require__(/*! ./loader.js */ 30);\n\t\n\tvar _gameJs = __webpack_require__(/*! ./game.js */ 13);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tfunction preload() {\n\t    // TODO: Tirar isso?\n\t    _storeJs.state.game.stage.disableVisibilityChange = true;\n\t\n\t    _storeJs.state.game.load.audio('song', ['assets/audio/song.ogg']);\n\t}\n\t\n\tfunction create() {\n\t    var song = _storeJs.state.game.add.audio('song', 1, true);\n\t    _storeJs.state.game.sound.setDecodedCallback([song], function () {\n\t        return (0, _gameJs.playSong)('song');\n\t    }, this);\n\t    _storeJs.state.game.createdSounds = { song: song };\n\t    (0, _loaderJs.mainLoad)();\n\t}\n\t\n\tfunction update() {}\n\t\n\t_storeJs.state.game = new Phaser.Game(0, 0, Phaser.AUTO, 'app', { preload: preload,\n\t    create: create,\n\t    update: update });\n\n/***/ },\n/* 1 */\n/*!**********************!*\\\n  !*** ./src/store.js ***!\n  \\**********************/\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\tvar shrines = {\n\t    water: {\n\t        position: [10, 0, 0],\n\t        walkablePos: [9, 0, 0],\n\t        soundName: 'stream',\n\t        gain: 15,\n\t        // color: 0x0000ff,\n\t        color: 0x00376e\n\t    },\n\t    earth: {\n\t        position: [8, 10, 0],\n\t        walkablePos: [8, 9, 0],\n\t        soundName: 'earth',\n\t        gain: 2,\n\t        // color: 0xa16020,\n\t        color: 0x376e00\n\t    },\n\t    air: {\n\t        position: [0, -2, 0],\n\t        walkablePos: [0, -1, 0],\n\t        soundName: 'wind',\n\t        gain: 4,\n\t        // color: 0xaaaaaa,\n\t        color: 0x3a0371\n\t    },\n\t    fire: {\n\t        position: [-2, 7, 0],\n\t        walkablePos: [-1, 7, 0],\n\t        soundName: 'fire',\n\t        gain: 4,\n\t        // color: 0xff0000,\n\t        color: 0x6e3700\n\t    }\n\t};\n\t\n\texports.shrines = shrines;\n\tvar state = {\n\t    state: 'pregame',\n\t    level: 1,\n\t    position: [4, 4, 0],\n\t    direction: 'e',\n\t    followed: [],\n\t    presences: {},\n\t    darkPresence: {},\n\t    power: [],\n\t    filters: [],\n\t    tint: null,\n\t    // if is waiting the load of an image for the vision\n\t    loadingVision: false,\n\t    // if should play intro or skip it\n\t    playIntro: true,\n\t    // current playing or last played song\n\t    currentSong: null\n\t};\n\t\n\texports.state = state;\n\t// Debug TODO: remover?\n\twindow.s = state;\n\n/***/ },\n/* 2 */,\n/* 3 */\n/*!**********************!*\\\n  !*** ./src/utils.js ***!\n  \\**********************/\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports.randInt = randInt;\n\texports.equalArrays = equalArrays;\n\texports.textToPos = textToPos;\n\texports.posToText = posToText;\n\texports.posDirToText = posDirToText;\n\texports.posDist = posDist;\n\texports.rotLeft = rotLeft;\n\texports.rotRight = rotRight;\n\texports.rot180 = rot180;\n\texports.getBounds = getBounds;\n\tvar directions = ['n', 'e', 's', 'w'];\n\t\n\t// Return a random int from 0 to x-1\n\t\n\tfunction randInt(x) {\n\t    return Math.floor(Math.random() * x);\n\t}\n\t\n\t// Check if two arrays have the same numbers in the same order\n\t\n\tfunction equalArrays(a1, a2) {\n\t    var equal = true;\n\t    for (var i in a1) {\n\t        if (a1[i] != a2[i]) {\n\t            equal = false;\n\t            break;\n\t        }\n\t    }\n\t    return equal;\n\t}\n\t\n\t// Converts a text to a position. e.g.: '2_4_5' -> [2,4,5]\n\t\n\tfunction textToPos(t) {\n\t    return t.split('_').map(function (x) {\n\t        return parseInt(x);\n\t    });\n\t}\n\t\n\t// Converts a position to text. e.g.: [2,4,5] -> '2_4_5'\n\t\n\tfunction posToText(pos) {\n\t    return pos.join('_');\n\t}\n\t\n\t// Converts a position and a direction to text. e.g.: [2,4,5], 'n' -> '2_4_5_n'\n\t\n\tfunction posDirToText(pos, direction) {\n\t    return posToText(pos) + '_' + direction;\n\t}\n\t\n\t// Returns eclidean distance between 2 positions\n\t\n\tfunction posDist(p1, p2) {\n\t    return Math.sqrt(Math.pow(p1[0] - p2[0], 2) + Math.pow(p1[1] - p2[1], 2) + Math.pow(p1[2] - p2[2], 2));\n\t}\n\t\n\t// Returns a rotated direction to the left\n\t\n\tfunction rotLeft(dir) {\n\t    if (dir == 'n') return 'w';else return directions[directions.indexOf(dir) - 1];\n\t}\n\t\n\t// Returns a rotated direction to the right\n\t\n\tfunction rotRight(dir) {\n\t    if (dir == 'w') return 'n';else return directions[directions.indexOf(dir) + 1];\n\t}\n\t\n\t// Returns the oposite direction\n\t\n\tfunction rot180(dir) {\n\t    return rotLeft(rotLeft(dir));\n\t}\n\t\n\tfunction getBounds(obj) {\n\t    return [obj.x, obj.y, obj.width, obj.height];\n\t}\n\n/***/ },\n/* 4 */,\n/* 5 */,\n/* 6 */,\n/* 7 */\n/*!***********************!*\\\n  !*** ./src/vision.js ***!\n  \\***********************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports.addEffect = addEffect;\n\texports.loadVision = loadVision;\n\texports.resize = resize;\n\t\n\tvar _utilsJs = __webpack_require__(/*! ./utils.js */ 3);\n\t\n\tvar _interfaceJs = __webpack_require__(/*! ./interface.js */ 14);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tfunction setVision() {\n\t    var isResize = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];\n\t\n\t    if (!isResize) _storeJs.state.loadingVision = false;\n\t\n\t    if (_storeJs.state.img) _storeJs.state.img.destroy();\n\t    _storeJs.state.img = _storeJs.state.game.add.image(0, 0, (0, _utilsJs.posDirToText)(_storeJs.state.position, _storeJs.state.direction));\n\t    _storeJs.state.layers.back.add(_storeJs.state.img);\n\t    var r = Math.min(_storeJs.state.game.width / _storeJs.state.img.width, _storeJs.state.game.height / _storeJs.state.img.height);\n\t    _storeJs.state.img.scale.setTo(r);\n\t    _storeJs.state.img.x = (_storeJs.state.game.width - _storeJs.state.img.width) / 2;\n\t    _storeJs.state.img.y = (_storeJs.state.game.height - _storeJs.state.img.height) / 2;\n\t\n\t    // Round bounds\n\t    var bounds = ['x', 'y', 'width', 'height'];\n\t    bounds.map(function (key) {\n\t        return _storeJs.state.img[key] = Math.round(_storeJs.state.img[key]);\n\t    });\n\t\n\t    // Set tint\n\t    if (_storeJs.state.tint) _storeJs.state.img.tint = _storeJs.state.tint;\n\t    // Set filter\n\t    if (_storeJs.state.filters.length) _storeJs.state.img.filters = _storeJs.state.filters;\n\t\n\t    // Map img bounds to interface\n\t    (0, _interfaceJs.setInterfaceBounds)((0, _utilsJs.getBounds)(_storeJs.state.img));\n\t\n\t    // Enable mouse move\n\t    if (_storeJs.state.onTap) {\n\t        _storeJs.state.img.inputEnabled = true;\n\t        _storeJs.state.img.events.onInputUp.add(_storeJs.state.onTap, this);\n\t    }\n\t\n\t    if (_storeJs.state.onSetVision) _storeJs.state.onSetVision(isResize);\n\t}\n\t\n\tfunction addEffect(state, color, alpha) {\n\t    if (state.effect) state.effect.destroy();\n\t    state.effect = state.game.add.graphics(0, 0);\n\t    state.effect.beginFill(color, alpha);\n\t    state.effect.drawRect(state.img.x, state.img.y, state.img.width, state.img.height);\n\t    state.effect.endFill();\n\t    state.layers.front.add(state.effect);\n\t    return state.effect;\n\t}\n\t\n\tfunction loadVision(state) {\n\t    var s = (0, _utilsJs.posDirToText)(state.position, state.direction);\n\t    if (!state.game.cache.checkImageKey(s)) {\n\t        state.loadingVision = true;\n\t        state.game.load.image(s, 'assets/map/' + s + '.jpg').onFileComplete.add(function () {\n\t            return setVision();\n\t        });\n\t        state.game.load.start();\n\t    } else {\n\t        setVision();\n\t    }\n\t}\n\t\n\tfunction resize() {\n\t    _storeJs.state.game.scale.setGameSize(window.innerWidth, window.innerHeight);\n\t    setVision(true);\n\t}\n\t\n\t// Resizes game on window resize\n\t// based on: http://www.html5gamedevs.com/topic/13900-doubt-about-making-my-game-responsive-on-onresize/\n\t// The delay is supposed to help on some devices\n\twindow.addEventListener('resize', function () {\n\t    return _storeJs.state.game.time.events.add(200, resize);\n\t}, false);\n\n/***/ },\n/* 8 */,\n/* 9 */,\n/* 10 */,\n/* 11 */\n/*!**********************!*\\\n  !*** ./src/audio.js ***!\n  \\**********************/\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\t\n\tvar _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();\n\t\n\texports.setListenerPos = setListenerPos;\n\texports.setAudioOri = setAudioOri;\n\texports.setPannerPos = setPannerPos;\n\texports.addSound = addSound;\n\tvar audioMult = 1;\n\t\n\tfunction setListenerPos(context, pos) {\n\t    // The +1 avoids 0 distance. It hurts the ears.\n\t    context.listener.setPosition(pos[0] * audioMult, pos[2] + 1, -pos[1] * audioMult);\n\t}\n\t\n\tfunction setAudioOri(context, direction) {\n\t    var _direction = _slicedToArray(direction, 3);\n\t\n\t    var x = _direction[0];\n\t    var y = _direction[1];\n\t    var z = _direction[2];\n\t\n\t    context.listener.setOrientation(x, z, -y, 0, 1, 0);\n\t}\n\t\n\tfunction setPannerPos(panner, pos) {\n\t    var _pos = _slicedToArray(pos, 3);\n\t\n\t    var x = _pos[0];\n\t    var y = _pos[1];\n\t    var z = _pos[2];\n\t\n\t    panner.setPosition(x * audioMult, z * audioMult, -y * audioMult);\n\t}\n\t\n\tfunction addSound(game, position, soundName) {\n\t    var soundGain = arguments.length <= 3 || arguments[3] === undefined ? 1 : arguments[3];\n\t\n\t    var audio = game.add.audio(soundName);\n\t    var panner = game.sound.context.createPanner();\n\t\n\t    panner.panningModel = 'HRTF';\n\t    panner.distanceModel = 'exponential';\n\t    panner.refDistance = 1;\n\t    panner.maxDistance = 4;\n\t    panner.rolloffFactor = 4;\n\t\n\t    audio.gainNode.disconnect();\n\t    audio.gainNode.connect(panner);\n\t\n\t    // panner.connect(game.sound.masterGain)\n\t    var volume = game.sound.context.createGain();\n\t    panner.connect(volume);\n\t    volume.connect(game.sound.masterGain);\n\t    volume.gain.value = soundGain;\n\t\n\t    setPannerPos(panner, position);\n\t    audio.loop = true;\n\t    audio.play();\n\t\n\t    return { audio: audio, panner: panner, volume: volume };\n\t}\n\n/***/ },\n/* 12 */\n/*!*****************************!*\\\n  !*** ./src/createAudios.js ***!\n  \\*****************************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports.createCommonAudios = createCommonAudios;\n\texports.createPositionedAudios = createPositionedAudios;\n\texports.changePresenceSoundGain = changePresenceSoundGain;\n\t\n\tvar _audioJs = __webpack_require__(/*! ./audio.js */ 11);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tfunction createCommonAudios() {\n\t    // steps sound\n\t    var steps = _storeJs.state.game.add.audio('steps');\n\t    steps.allowMultiple = true;\n\t    for (var i = 0; i < 6; i++) {\n\t        steps.addMarker(i, i, 1);\n\t    }\n\t\n\t    // more sounds\n\t    Object.assign(_storeJs.state.game.createdSounds, {\n\t        steps: steps,\n\t        harp: _storeJs.state.game.add.audio('harp', 0.8),\n\t        harpStart: _storeJs.state.game.add.audio('harp_start', 0.8),\n\t        button: _storeJs.state.game.add.audio('button', 0.5),\n\t        magic: _storeJs.state.game.add.audio('magic'),\n\t        magicNo: _storeJs.state.game.add.audio('magic_no'),\n\t        magicRequest: _storeJs.state.game.add.audio('magic_request'),\n\t        magicArrived: _storeJs.state.game.add.audio('magic_arrived'),\n\t        darkSpell: _storeJs.state.game.add.audio('dark_spell', 1.5),\n\t        darkSong: _storeJs.state.game.add.audio('dark_song', 1, true),\n\t        darkPresence: _storeJs.state.game.add.audio('dark_presence', 1, true),\n\t        rarr: _storeJs.state.game.add.audio('rarr'),\n\t        end2: _storeJs.state.game.add.audio('end2')\n\t    });\n\t}\n\t\n\tfunction createPositionedAudios() {\n\t    for (var k in _storeJs.shrines) {\n\t        var shrine = _storeJs.shrines[k];\n\t        // Add shrine\n\t        if (!shrine.sound) shrine.sound = (0, _audioJs.addSound)(_storeJs.state.game, shrine.position, shrine.soundName, shrine.gain);\n\t\n\t        var presence = _storeJs.state.presences[k];\n\t        // Add presence\n\t        if (!presence.sound) {\n\t            presence.sound = (0, _audioJs.addSound)(_storeJs.state.game, presence.position, shrine.soundName, shrine.gain);\n\t        } else {\n\t            (0, _audioJs.setPannerPos)(presence.sound.panner, presence.position);\n\t        }\n\t        changePresenceSoundGain(k, 1);\n\t    }\n\t\n\t    // Dark Presence\n\t    if (_storeJs.state.level == 2) {\n\t        var darkPres = _storeJs.state.darkPresence;\n\t        if (!darkPres.sound) {\n\t            _storeJs.state.darkPresence.sound = (0, _audioJs.addSound)(_storeJs.state.game, darkPres.position, 'dark_presence', 1.5);\n\t        } else {\n\t            (0, _audioJs.setPannerPos)(darkPres.sound.panner, darkPres.position);\n\t            _storeJs.state.darkPresence.sound.volume.gain.value = 1;\n\t        }\n\t    } else {\n\t        if (_storeJs.state.darkPresence.sound) {\n\t            _storeJs.state.darkPresence.sound.volume.gain.value = 0;\n\t        }\n\t    }\n\t}\n\t\n\tfunction changePresenceSoundGain(presenceName, mult) {\n\t    _storeJs.state.presences[presenceName].sound.volume.gain.value = _storeJs.shrines[presenceName].gain * mult;\n\t}\n\n/***/ },\n/* 13 */\n/*!*********************!*\\\n  !*** ./src/game.js ***!\n  \\*********************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports.playSong = playSong;\n\texports.stopSong = stopSong;\n\texports.touchedDarkPresence = touchedDarkPresence;\n\texports.onSetVision = onSetVision;\n\texports.interact = interact;\n\texports.playButtonSound = playButtonSound;\n\t\n\tvar _utilsJs = __webpack_require__(/*! ./utils.js */ 3);\n\t\n\tvar _movementJs = __webpack_require__(/*! ./movement.js */ 15);\n\t\n\tvar _visionJs = __webpack_require__(/*! ./vision.js */ 7);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tvar _createAudiosJs = __webpack_require__(/*! ./createAudios.js */ 12);\n\t\n\tfunction playSong(name) {\n\t    var fadeInTime = arguments.length <= 1 || arguments[1] === undefined ? 2000 : arguments[1];\n\t\n\t    if (_storeJs.state.currentSong) _storeJs.state.currentSong.stop();\n\t    _storeJs.state.currentSong = _storeJs.state.game.createdSounds[name];\n\t    _storeJs.state.currentSong.fadeIn(fadeInTime, true, '');\n\t}\n\t\n\tfunction stopSong() {\n\t    var fadeOutTime = arguments.length <= 0 || arguments[0] === undefined ? 2000 : arguments[0];\n\t\n\t    if (_storeJs.state.currentSong && _storeJs.state.currentSong.isPlaying) _storeJs.state.currentSong.fadeOut(fadeOutTime);\n\t}\n\t\n\tfunction touchedDarkPresence() {\n\t    if (_storeJs.state.followed.length == 4) _storeJs.state.won();else _storeJs.state.lost();\n\t}\n\t\n\tfunction onSetVision(isResize) {\n\t\n\t    // Make sure that the song won't play in game.\n\t    if (_storeJs.state.state == 'playing') stopSong();\n\t\n\t    // Effects\n\t    if (['pregame', 'starting'].includes(_storeJs.state.state)) {\n\t        (0, _visionJs.addEffect)(_storeJs.state, 0x000000, 1);\n\t        if (_storeJs.state.state == 'starting') {\n\t            _storeJs.state.state = 'playing';\n\t            stopSong();\n\t            _storeJs.state.game.add.tween(_storeJs.state.effect).to({ alpha: 0 }, 2000, \"Linear\", true);\n\t            if (!isResize) {\n\t                if (_storeJs.state.level == 1) _storeJs.state.game.createdSounds.harpStart.play();\n\t            }\n\t        }\n\t    }\n\t\n\t    // var tweenBack = state.game.add.tween(effect).to( { alpha: 0 }, 1000, \"Linear\")\n\t    // tweenTo.chain(tweenBack)\n\t    // tweenTo.start()\n\t\n\t    if (!isResize) {\n\t        checkFollowPresence();\n\t        checkInShrine();\n\t    }\n\t}\n\t\n\tfunction interact() {\n\t    if (_storeJs.state.state == 'playing') {\n\t        var presence = isInPresence(_storeJs.state.position);\n\t        if (presence && _storeJs.state.power.includes(presence) && !_storeJs.state.presences[presence].arrived) {\n\t\n\t            if (_storeJs.state.level == 2 || !_storeJs.state.followed.length) {\n\t                // presence starts to follow player\n\t                _storeJs.state.followed.push(presence);\n\t                (0, _createAudiosJs.changePresenceSoundGain)(presence, 0.25);\n\t                _storeJs.state.game.createdSounds.magicRequest.play();\n\t                if (_storeJs.state.level == 2) {\n\t                    // Gain color!\n\t                    _storeJs.state.tint += _storeJs.shrines[presence].color;\n\t                    if (_storeJs.state.filters.length) _storeJs.state.filters = [];\n\t                }\n\t                return true;\n\t            }\n\t        }\n\t        _storeJs.state.game.createdSounds.magicNo.play();\n\t    }\n\t\n\t    return false;\n\t}\n\t\n\tfunction checkFollowPresence() {\n\t    // if (state.followed) {\n\t    var _iteratorNormalCompletion = true;\n\t    var _didIteratorError = false;\n\t    var _iteratorError = undefined;\n\t\n\t    try {\n\t        for (var _iterator = _storeJs.state.followed[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t            var p = _step.value;\n\t\n\t            (0, _movementJs.changePresencePos)(_storeJs.state.presences[p], _storeJs.state.position, 2000);\n\t        }\n\t        // }\n\t    } catch (err) {\n\t        _didIteratorError = true;\n\t        _iteratorError = err;\n\t    } finally {\n\t        try {\n\t            if (!_iteratorNormalCompletion && _iterator['return']) {\n\t                _iterator['return']();\n\t            }\n\t        } finally {\n\t            if (_didIteratorError) {\n\t                throw _iteratorError;\n\t            }\n\t        }\n\t    }\n\t}\n\t\n\t// Check if is in a different shrine and set player power\n\tfunction checkInShrine() {\n\t    var shrine = isInShrine(_storeJs.state.position);\n\t    if (shrine) {\n\t        if (_storeJs.state.level == 1) {\n\t            // If not followed and entering a shrine of different power\n\t            // that still hasn't its presence\n\t            if (!_storeJs.state.followed.length && !_storeJs.state.presences[shrine].arrived) {\n\t                var newPower = true;\n\t                if (_storeJs.state.power.length && _storeJs.state.power[0] == shrine) newPower = false;\n\t                if (newPower) setPower(shrine, true);\n\t                // If followed by presence of the current shrine\n\t            } else if (_storeJs.state.followed.includes(shrine)) {\n\t                    presenceArrived(_storeJs.state, shrine);\n\t                }\n\t        } else {\n\t            if (!_storeJs.state.power.includes(shrine)) setPower(shrine);\n\t        }\n\t    }\n\t}\n\t\n\tfunction presenceArrived(state, presence) {\n\t    state.presences[presence].arrived = true;\n\t    (0, _createAudiosJs.changePresenceSoundGain)(presence, 1);\n\t    // Pop presence from followed\n\t    state.followed.splice(state.followed.indexOf(presence), 1);\n\t    // Pop power\n\t    state.power.splice(state.power.indexOf(presence), 1);\n\t    state.game.createdSounds.magicArrived.play();\n\t\n\t    // If all presences arrived: The end!\n\t    if (Object.keys(state.presences).reduce(function (p, c) {\n\t        return p && state.presences[c].arrived;\n\t    }, true)) {\n\t        state.game.createdSounds.magicArrived.onStop.add(function () {\n\t            state.won();\n\t            state.game.createdSounds.magicArrived.onStop.removeAll();\n\t        });\n\t    }\n\t}\n\t\n\t// Set player power and display effect/sound\n\tfunction setPower(power) {\n\t    var replace = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];\n\t\n\t    if (replace) _storeJs.state.power = [];\n\t    _storeJs.state.power.push(power);\n\t\n\t    // visual effect when entering a different shrine\n\t    var effect = (0, _visionJs.addEffect)(_storeJs.state, _storeJs.shrines[power].color, 0.5);\n\t    effect.alpha = 0;\n\t    var tweenTo = _storeJs.state.game.add.tween(effect).to({ alpha: 1 }, 1000, \"Linear\");\n\t    var tweenBack = _storeJs.state.game.add.tween(effect).to({ alpha: 0 }, 1000, \"Linear\");\n\t    tweenTo.chain(tweenBack);\n\t    tweenTo.start();\n\t    _storeJs.state.game.createdSounds.magic.play();\n\t    tweenBack.onComplete.add(function () {\n\t        return effect.destroy();\n\t    });\n\t}\n\t\n\t// check if position is the same of a shrine\n\tfunction isInShrine(position) {\n\t    for (var k in _storeJs.shrines) {\n\t        if ((0, _utilsJs.equalArrays)(position, _storeJs.shrines[k].walkablePos)) return k;\n\t    }\n\t    return null;\n\t}\n\t\n\t// check if position is the same of a presence\n\tfunction isInPresence(position) {\n\t    for (var k in _storeJs.state.presences) {\n\t        if ((0, _utilsJs.equalArrays)(position, _storeJs.state.presences[k].position) && !_storeJs.state.followed.includes(k)) return k;\n\t    }\n\t    return null;\n\t}\n\t\n\tfunction playButtonSound() {\n\t    _storeJs.state.game.createdSounds.button.play();\n\t}\n\t\n\t// function createGameElements() {\n\t//     console.log('Creating...')\n\t\n\t//     // state.game.createdSounds.song.stop()\n\t//     // hideInterface()\n\t//     // startLevel()\n\t//     // setTimeout(function () {\n\t//     //     for (let p in state.presences) {\n\t//     //         state.followed = p\n\t//     //         presenceArrived(state)\n\t//     //     }\n\t//     // }, 2000)\n\t\n\t//     // setTimeout(function () {\n\t//     //     // TODO: tratar melhor qual música para/toca\n\t//     //     state.game.createdSounds.song.stop()\n\t//     //     // loadLevel2()\n\t//     //     // toLevel2intro()\n\t//     // }, 2000)\n\t\n\t//     // loadLevel2()\n\t//     // randomizePresencePositions(state.position)\n\t//     // startLevel()\n\t\n\t//     // openPage('controls', false)\n\t//     // openPage('instrorstart', false)\n\t\n\t//     // Debug\n\t//     // state.effect2 = state.game.add.graphics(0, 0)\n\t//     // state.effect2.beginFill(0xff0000, 1)\n\t//     // state.effect2.drawRect(0, 0, 10, 10)\n\t//     // state.effect2.endFill()\n\t// }\n\t\n\tfunction cheatLevel1() {\n\t    for (var p in _storeJs.state.presences) {\n\t        _storeJs.state.followed.push(p);\n\t        presenceArrived(_storeJs.state, p);\n\t    }\n\t}\n\tfunction cheatLevel2() {\n\t    for (var p in _storeJs.state.presences) {\n\t        _storeJs.state.followed.push(p);\n\t    }\n\t    // touchedDarkPresence()\n\t}\n\twindow.cheats = {\n\t    l1: cheatLevel1,\n\t    l2: cheatLevel2\n\t};\n\n/***/ },\n/* 14 */\n/*!**************************!*\\\n  !*** ./src/interface.js ***!\n  \\**************************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.setInterfaceBounds = setInterfaceBounds;\n\texports.openPage = openPage;\n\texports.showInterface = showInterface;\n\texports.hideInterface = hideInterface;\n\texports.hideLoadingScreen = hideLoadingScreen;\n\tvar pages = {\n\t    mainmenu: __webpack_require__(/*! text!./pages/mainmenu.html */ 74),\n\t    controls: __webpack_require__(/*! text!./pages/controls.html */ 58),\n\t    instructions: __webpack_require__(/*! text!./pages/instructions.html */ 63),\n\t    instrorstart: __webpack_require__(/*! text!./pages/instrorstart.html */ 62),\n\t    history: __webpack_require__(/*! text!./pages/history.html */ 61),\n\t    cantsee: __webpack_require__(/*! text!./pages/cantsee.html */ 57),\n\t    end1: __webpack_require__(/*! text!./pages/end1.html */ 60),\n\t    l2intro: __webpack_require__(/*! text!./pages/l2intro.html */ 67),\n\t    l2intro2: __webpack_require__(/*! text!./pages/l2intro2.html */ 68),\n\t    l2intro3: __webpack_require__(/*! text!./pages/l2intro3.html */ 69),\n\t    l2intro3a: __webpack_require__(/*! text!./pages/l2intro3a.html */ 70),\n\t    l2intro4: __webpack_require__(/*! text!./pages/l2intro4.html */ 71),\n\t    l2intro5: __webpack_require__(/*! text!./pages/l2intro5.html */ 72),\n\t    lost2: __webpack_require__(/*! text!./pages/lost2.html */ 73),\n\t    l2end1: __webpack_require__(/*! text!./pages/l2end1.html */ 64),\n\t    l2end2: __webpack_require__(/*! text!./pages/l2end2.html */ 65),\n\t    l2end3: __webpack_require__(/*! text!./pages/l2end3.html */ 66),\n\t    credits: __webpack_require__(/*! text!./pages/credits.html */ 59)\n\t};\n\t\n\tfunction getDiv() {\n\t    var outer = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];\n\t\n\t    if (outer) return document.getElementById('interface-outer');else return document.getElementById('interface');\n\t}\n\t\n\tfunction setInterfaceBounds(bounds) {\n\t    var outer = getDiv(true);\n\t    bounds.map(function (val, index) {\n\t        outer.style[this[index]] = val + 'px';\n\t    }, [\"left\", \"top\", \"width\", \"height\"]);\n\t\n\t    getDiv().style.padding = bounds[2] / 8 + \"px \" + bounds[3] / 8 + \"px\";\n\t}\n\t\n\tfunction openPage(name) {\n\t    var playSound = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\t    var replace = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];\n\t\n\t    showInterface();\n\t    var text = pages[name];\n\t    if (replace) text = text.replace('{{}}', replace);\n\t    getDiv().innerHTML = \"<div class=\\\"page\\\">\" + text + \"</div>\";\n\t    if (playSound) window.playButtonSound();\n\t    window.scrollTo(0, 0);\n\t}\n\t\n\tfunction showInterface() {\n\t    var inter = getDiv();\n\t    inter.style.zIndex = 1;\n\t    inter.style.opacity = 1;\n\t    var outer = getDiv(true);\n\t    outer.style.pointerEvents = 'auto';\n\t}\n\t\n\tfunction hideInterface() {\n\t    var inter = getDiv();\n\t    inter.style.zIndex = -1;\n\t    inter.style.opacity = 0;\n\t    inter.innerHTML = '';\n\t    var outer = getDiv(true);\n\t    outer.style.pointerEvents = 'none';\n\t}\n\t\n\tfunction hideLoadingScreen() {\n\t    var el = document.getElementById('loading-screen');\n\t    if (el) el.parentNode.removeChild(el);\n\t}\n\t\n\twindow.openPage = openPage;\n\n/***/ },\n/* 15 */\n/*!*************************!*\\\n  !*** ./src/movement.js ***!\n  \\*************************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\t\n\tvar _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();\n\t\n\texports.changeDarkPresencePos = changeDarkPresencePos;\n\texports.move = move;\n\texports.changePresencePos = changePresencePos;\n\texports.tweenPos = tweenPos;\n\texports.initPlayerPos = initPlayerPos;\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\t\n\tvar _assetsMapMapJs = __webpack_require__(/*! ../assets/map/map.js */ 21);\n\t\n\tvar _assetsMapMapJs2 = _interopRequireDefault(_assetsMapMapJs);\n\t\n\tvar _utilsJs = __webpack_require__(/*! ./utils.js */ 3);\n\t\n\tvar _audioJs = __webpack_require__(/*! ./audio.js */ 11);\n\t\n\tvar _visionJs = __webpack_require__(/*! ./vision.js */ 7);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tvar walk = {\n\t    e: [1, 0, 0],\n\t    s: [0, -1, 0],\n\t    w: [-1, 0, 0],\n\t    n: [0, 1, 0]\n\t};\n\t\n\tfunction tryChangePos(direction) {\n\t    var newPos = _assetsMapMapJs2['default'][(0, _utilsJs.posToText)(_storeJs.state.position)][direction];\n\t    if (newPos) {\n\t        var oldPos = _storeJs.state.position;\n\t        _storeJs.state.position = newPos;\n\t        var posSetter = function posSetter(pos) {\n\t            return (0, _audioJs.setListenerPos)(_storeJs.state.game.sound.context, pos);\n\t        };\n\t        tweenPos(oldPos, newPos, posSetter, 500, _storeJs.state, 'Move');\n\t        _storeJs.state.game.createdSounds.steps.play((0, _utilsJs.randInt)(5));\n\t        return true;\n\t    }\n\t    return false;\n\t}\n\t\n\tfunction changeDarkPresencePos(playerPos, fTouched) {\n\t    var oldPos = _storeJs.state.darkPresence.position;\n\t    var posSetter = function posSetter(pos) {\n\t        if (_storeJs.state.state == 'playing') {\n\t            (0, _audioJs.setPannerPos)(_storeJs.state.darkPresence.sound.panner, pos);\n\t            _storeJs.state.darkPresence.position = pos;\n\t            // state.effect2.x = pos[0] * 50\n\t            // state.effect2.y = pos[1] * 50\n\t            if ((0, _utilsJs.posDist)(pos, _storeJs.state.position) < 0.5 && fTouched) fTouched();\n\t        }\n\t    };\n\t    var time = (0, _utilsJs.posDist)(oldPos, playerPos) * 2500;\n\t    tweenPos(oldPos, playerPos, posSetter, time, _storeJs.state.darkPresence);\n\t}\n\t\n\tfunction move(event, key) {\n\t    if (_storeJs.state.state == 'playing' && !_storeJs.state.loadingVision\n\t    /*&& noRecentMove(state, 1000)*/) {\n\t            var moved = false;\n\t            var rotated = false;\n\t            switch (key) {\n\t                case 'UP':\n\t                    moved = tryChangePos(_storeJs.state.direction);\n\t                    break;\n\t                case 'DOWN':\n\t                    moved = tryChangePos((0, _utilsJs.rot180)(_storeJs.state.direction));\n\t                    break;\n\t                case 'LEFT':\n\t                    rotatePlayer(_storeJs.state, 'left');\n\t                    rotated = true;\n\t                    break;\n\t                case 'RIGHT':\n\t                    rotatePlayer(_storeJs.state, 'right');\n\t                    rotated = true;\n\t                    break;\n\t            }\n\t            // checkTeleportation(state)\n\t            if (rotated || moved) (0, _visionJs.loadVision)(_storeJs.state);\n\t            if (moved && _storeJs.state.onMoved) _storeJs.state.onMoved();\n\t        }\n\t}\n\t\n\tfunction rotatePlayer(state, type) {\n\t    var oldPos = walk[state.direction];\n\t    if (type == 'left') state.direction = (0, _utilsJs.rotLeft)(state.direction);else state.direction = (0, _utilsJs.rotRight)(state.direction);\n\t    var newPos = walk[state.direction];\n\t    var posSetter = function posSetter(pos) {\n\t        return (0, _audioJs.setAudioOri)(state.game.sound.context, pos);\n\t    };\n\t    tweenPos(oldPos, newPos, posSetter, 500, state, 'Rotate');\n\t}\n\t\n\tfunction changePresencePos(presence, newPos, time) {\n\t    var oldPos = presence.position;\n\t    presence.position = newPos;\n\t    var posSetter = function posSetter(pos) {\n\t        return (0, _audioJs.setPannerPos)(presence.sound.panner, pos);\n\t    };\n\t    tweenPos(oldPos, newPos, posSetter, time, presence);\n\t}\n\t\n\t// Tween a position running posSetter on each interaction.\n\t// Store tween in 'store', use 'tween'+extraName to name the pointer.\n\t\n\tfunction tweenPos(oldPos, newPos, posSetter, time, store, extraName) {\n\t    var _oldPos = _slicedToArray(oldPos, 3);\n\t\n\t    var ox = _oldPos[0];\n\t    var oy = _oldPos[1];\n\t    var oz = _oldPos[2];\n\t\n\t    var _newPos = _slicedToArray(newPos, 3);\n\t\n\t    var nx = _newPos[0];\n\t    var ny = _newPos[1];\n\t    var nz = _newPos[2];\n\t\n\t    var obj = { x: ox, y: oy, z: oz };\n\t    var tweenTo = _storeJs.state.game.add.tween(obj).to({ x: nx, y: ny, z: nz }, time, \"Linear\");\n\t    var updateFunc = function updateFunc() {\n\t        return posSetter([obj.x, obj.y, obj.z]);\n\t    };\n\t    tweenTo.onUpdateCallback(updateFunc);\n\t    tweenTo.onComplete.add(updateFunc);\n\t    tweenTo.start();\n\t    // Remove old tween, save pointer to new tween\n\t    if (store) {\n\t        var name = 'tween';\n\t        if (extraName) name += extraName;\n\t        if (store[name]) store[name].stop();\n\t        store[name] = tweenTo;\n\t    }\n\t}\n\t\n\tfunction initPlayerPos() {\n\t    (0, _audioJs.setListenerPos)(_storeJs.state.game.sound.context, _storeJs.state.position);\n\t    (0, _audioJs.setAudioOri)(_storeJs.state.game.sound.context, walk[_storeJs.state.direction]);\n\t}\n\t\n\t// function noRecentMove(state, time) {\n\t//     var currTime = new Date().getTime()\n\t//     if (state.lastMoveTime) {\n\t//         if (Math.abs(currTime - state.lastMoveTime) < time) return false\n\t//     }\n\t//     state.lastMoveTime = currTime\n\t//     return true\n\t// }\n\n/***/ },\n/* 16 */,\n/* 17 */,\n/* 18 */,\n/* 19 */,\n/* 20 */,\n/* 21 */\n/*!***************************!*\\\n  !*** ./assets/map/map.js ***!\n  \\***************************/\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar map = { \"4_0_0\": { \"e\": [5, 0, 0], \"n\": [4, 1, 0], \"w\": [3, 0, 0] }, \"6_6_0\": { \"s\": [6, 5, 0], \"e\": [7, 6, 0], \"w\": [5, 6, 0] }, \"2_6_0\": { \"s\": [2, 5, 0], \"e\": [3, 6, 0] }, \"3_7_0\": { \"s\": [3, 6, 0], \"e\": [4, 7, 0] }, \"8_3_0\": { \"s\": [8, 2, 0], \"n\": [8, 4, 0] }, \"1_2_0\": { \"e\": [2, 2, 0], \"n\": [1, 3, 0], \"w\": [0, 2, 0] }, \"3_0_0\": { \"e\": [4, 0, 0], \"w\": [2, 0, 0] }, \"0_2_0\": { \"s\": [0, 1, 0], \"e\": [1, 2, 0] }, \"-1_7_0\": { \"e\": [0, 7, 0] }, \"3_4_0\": { \"e\": [4, 4, 0], \"w\": [2, 4, 0] }, \"6_7_0\": { \"e\": [7, 7, 0], \"w\": [5, 7, 0] }, \"6_4_0\": { \"s\": [6, 3, 0], \"e\": [7, 4, 0], \"n\": [6, 5, 0], \"w\": [5, 4, 0] }, \"1_8_0\": { \"s\": [1, 7, 0], \"w\": [0, 8, 0] }, \"1_0_0\": { \"n\": [1, 1, 0], \"w\": [0, 0, 0] }, \"8_6_0\": { \"s\": [8, 5, 0], \"w\": [7, 6, 0] }, \"6_3_0\": { \"s\": [6, 2, 0], \"n\": [6, 4, 0] }, \"4_4_0\": { \"s\": [4, 3, 0], \"e\": [5, 4, 0], \"n\": [4, 5, 0], \"w\": [3, 4, 0] }, \"8_8_0\": { \"s\": [8, 7, 0], \"n\": [8, 9, 0] }, \"6_5_0\": { \"s\": [6, 4, 0], \"n\": [6, 6, 0] }, \"5_1_0\": { \"s\": [5, 0, 0], \"n\": [5, 2, 0] }, \"3_2_0\": { \"s\": [3, 1, 0] }, \"0_7_0\": { \"n\": [0, 8, 0], \"w\": [-1, 7, 0] }, \"7_0_0\": { \"e\": [8, 0, 0], \"w\": [6, 0, 0] }, \"4_3_0\": { \"s\": [4, 2, 0], \"n\": [4, 4, 0] }, \"7_7_0\": { \"s\": [7, 6, 0], \"e\": [8, 7, 0], \"n\": [7, 8, 0], \"w\": [6, 7, 0] }, \"2_2_0\": { \"w\": [1, 2, 0] }, \"7_2_0\": { \"s\": [7, 1, 0], \"e\": [8, 2, 0], \"w\": [6, 2, 0] }, \"4_1_0\": { \"s\": [4, 0, 0] }, \"1_1_0\": { \"s\": [1, 0, 0], \"e\": [2, 1, 0], \"w\": [0, 1, 0] }, \"2_1_0\": { \"s\": [2, 0, 0], \"e\": [3, 1, 0], \"w\": [1, 1, 0] }, \"2_5_0\": { \"n\": [2, 6, 0], \"w\": [1, 5, 0] }, \"8_2_0\": { \"n\": [8, 3, 0], \"w\": [7, 2, 0] }, \"2_4_0\": { \"s\": [2, 3, 0], \"e\": [3, 4, 0], \"w\": [1, 4, 0] }, \"8_4_0\": { \"s\": [8, 3, 0], \"n\": [8, 5, 0], \"w\": [7, 4, 0] }, \"0_5_0\": { \"n\": [0, 6, 0] }, \"1_4_0\": { \"s\": [1, 3, 0], \"e\": [2, 4, 0], \"n\": [1, 5, 0], \"w\": [0, 4, 0] }, \"6_1_0\": { \"s\": [6, 0, 0], \"e\": [7, 1, 0] }, \"0_1_0\": { \"e\": [1, 1, 0], \"n\": [0, 2, 0] }, \"5_2_0\": { \"s\": [5, 1, 0], \"e\": [6, 2, 0], \"w\": [4, 2, 0] }, \"1_7_0\": { \"s\": [1, 6, 0], \"e\": [2, 7, 0], \"n\": [1, 8, 0] }, \"1_5_0\": { \"s\": [1, 4, 0], \"e\": [2, 5, 0] }, \"2_3_0\": { \"n\": [2, 4, 0], \"w\": [1, 3, 0] }, \"3_6_0\": { \"n\": [3, 7, 0], \"w\": [2, 6, 0] }, \"4_6_0\": { \"s\": [4, 5, 0], \"n\": [4, 7, 0] }, \"0_8_0\": { \"s\": [0, 7, 0], \"e\": [1, 8, 0] }, \"5_7_0\": { \"e\": [6, 7, 0], \"w\": [4, 7, 0] }, \"9_0_0\": { \"w\": [8, 0, 0] }, \"3_1_0\": { \"n\": [3, 2, 0], \"w\": [2, 1, 0] }, \"8_9_0\": { \"s\": [8, 8, 0] }, \"4_8_0\": { \"e\": [5, 8, 0], \"w\": [3, 8, 0] }, \"5_4_0\": { \"e\": [6, 4, 0], \"w\": [4, 4, 0] }, \"0_0_0\": { \"s\": [0, -1, 0], \"e\": [1, 0, 0] }, \"4_2_0\": { \"e\": [5, 2, 0], \"n\": [4, 3, 0] }, \"3_8_0\": { \"e\": [4, 8, 0], \"w\": [2, 8, 0] }, \"5_0_0\": { \"n\": [5, 1, 0], \"w\": [4, 0, 0] }, \"7_6_0\": { \"e\": [8, 6, 0], \"n\": [7, 7, 0], \"w\": [6, 6, 0] }, \"2_8_0\": { \"s\": [2, 7, 0], \"e\": [3, 8, 0] }, \"8_7_0\": { \"n\": [8, 8, 0], \"w\": [7, 7, 0] }, \"2_7_0\": { \"n\": [2, 8, 0], \"w\": [1, 7, 0] }, \"0_-1_0\": { \"n\": [0, 0, 0] }, \"0_4_0\": { \"s\": [0, 3, 0], \"e\": [1, 4, 0] }, \"6_0_0\": { \"e\": [7, 0, 0], \"n\": [6, 1, 0] }, \"4_7_0\": { \"s\": [4, 6, 0], \"e\": [5, 7, 0], \"w\": [3, 7, 0] }, \"7_4_0\": { \"e\": [8, 4, 0], \"w\": [6, 4, 0] }, \"1_6_0\": { \"n\": [1, 7, 0], \"w\": [0, 6, 0] }, \"6_2_0\": { \"e\": [7, 2, 0], \"n\": [6, 3, 0], \"w\": [5, 2, 0] }, \"5_8_0\": { \"e\": [6, 8, 0], \"w\": [4, 8, 0] }, \"0_3_0\": { \"e\": [1, 3, 0], \"n\": [0, 4, 0] }, \"2_0_0\": { \"e\": [3, 0, 0], \"n\": [2, 1, 0] }, \"5_6_0\": { \"e\": [6, 6, 0] }, \"7_8_0\": { \"s\": [7, 7, 0], \"w\": [6, 8, 0] }, \"8_1_0\": { \"w\": [7, 1, 0] }, \"4_5_0\": { \"s\": [4, 4, 0], \"n\": [4, 6, 0] }, \"0_6_0\": { \"s\": [0, 5, 0], \"e\": [1, 6, 0] }, \"8_0_0\": { \"e\": [9, 0, 0], \"w\": [7, 0, 0] }, \"8_5_0\": { \"s\": [8, 4, 0], \"n\": [8, 6, 0] }, \"1_3_0\": { \"s\": [1, 2, 0], \"e\": [2, 3, 0], \"n\": [1, 4, 0], \"w\": [0, 3, 0] }, \"7_1_0\": { \"e\": [8, 1, 0], \"n\": [7, 2, 0], \"w\": [6, 1, 0] }, \"6_8_0\": { \"e\": [7, 8, 0], \"w\": [5, 8, 0] } };\n\texports[\"default\"] = map;\n\tmodule.exports = exports[\"default\"];\n\n/***/ },\n/* 22 */,\n/* 23 */,\n/* 24 */,\n/* 25 */,\n/* 26 */,\n/* 27 */,\n/* 28 */\n/*!**********************!*\\\n  !*** ./src/input.js ***!\n  \\**********************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\t\n\tvar _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();\n\t\n\texports.initKeyboardInput = initKeyboardInput;\n\texports.initMouseInput = initMouseInput;\n\t\n\tvar _utilsJs = __webpack_require__(/*! ./utils.js */ 3);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tfunction initKeyboardInput(fMove, fInteract) {\n\t    var _this = this;\n\t\n\t    var cursors = ['UP', 'DOWN', 'LEFT', 'RIGHT'];\n\t    cursors.map(function (key) {\n\t        return _storeJs.state.game.input.keyboard.addKey(Phaser.Keyboard[key]).onDown.add(fMove, _this, null, key);\n\t    });\n\t\n\t    _storeJs.state.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(fInteract, this, null);\n\t}\n\t\n\tfunction initMouseInput(fMove, fInteract) {\n\t    _storeJs.state.onTap = function (manager, pointer) {\n\t        return onTap(pointer, fMove, fInteract);\n\t    };\n\t}\n\t\n\tfunction onTap(pointer, fMove, fInteract) {\n\t    var x = pointer.x;\n\t    var y = pointer.y;\n\t\n\t    // The image is divided in 5 areas: top, bottom, left, right and\n\t    // center. A bigger p makes the center smaller and the other areas\n\t    // bigger but more narrow.\n\t    var p = 0.28;\n\t\n\t    var _getBounds = (0, _utilsJs.getBounds)(_storeJs.state.img);\n\t\n\t    var _getBounds2 = _slicedToArray(_getBounds, 4);\n\t\n\t    var ix = _getBounds2[0];\n\t    var iy = _getBounds2[1];\n\t    var iw = _getBounds2[2];\n\t    var ih = _getBounds2[3];\n\t\n\t    var ty = iy + ih * p;\n\t    var by = iy + ih * (1 - p);\n\t    var lx = ix + iw * p;\n\t    var rx = ix + iw * (1 - p);\n\t    // var area = null\n\t\n\t    // Left, Right or Middle\n\t    if (y > ty && y < by) {\n\t        if (x < lx) fMove(null, 'LEFT'); //area = 'left'\n\t        else if (x > rx) fMove(null, 'RIGHT'); //area = 'right'\n\t            else fInteract(); //area = 'center'\n\t        // Tor or Bottom\n\t    } else if (x > lx && x < rx) {\n\t            if (y < ty) fMove(null, 'UP'); //area = 'top'\n\t            else if (y > by) fMove(null, 'DOWN'); //area = 'bottom'\n\t        }\n\t}\n\n/***/ },\n/* 29 */\n/*!***********************!*\\\n  !*** ./src/levels.js ***!\n  \\***********************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports.startLevel = startLevel;\n\texports.pickLevel = pickLevel;\n\t\n\tvar _utilsJs = __webpack_require__(/*! ./utils.js */ 3);\n\t\n\tvar _interfaceJs = __webpack_require__(/*! ./interface.js */ 14);\n\t\n\tvar _visionJs = __webpack_require__(/*! ./vision.js */ 7);\n\t\n\tvar _randPosJs = __webpack_require__(/*! ./randPos.js */ 31);\n\t\n\tvar _movementJs = __webpack_require__(/*! ./movement.js */ 15);\n\t\n\tvar _createAudiosJs = __webpack_require__(/*! ./createAudios.js */ 12);\n\t\n\tvar _gameJs = __webpack_require__(/*! ./game.js */ 13);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tvar _audioJs = __webpack_require__(/*! ./audio.js */ 11);\n\t\n\tvar darkPresencePhrases = ['Raaaaarrrrr!!!!', 'Embrace Darkness!', \"You can't win!\", \"You can't hide!\", \"You can't escape!\", \"You are doomed!\", 'I found you.', 'Again?', 'Run faster next time.', 'Muhahahahah!', 'Unstoppable!'];\n\t\n\tfunction fadeGame() {\n\t    var fadeTime = arguments.length <= 0 || arguments[0] === undefined ? 2000 : arguments[0];\n\t\n\t    _storeJs.state.state = 'finished';\n\t    (0, _visionJs.addEffect)(_storeJs.state, 0x000000, 1);\n\t    _storeJs.state.effect.alpha = 0;\n\t    _storeJs.state.game.add.tween(_storeJs.state.effect).to({ alpha: 1 }, fadeTime, \"Linear\", true);\n\t}\n\t\n\tfunction wonLevel1() {\n\t    _storeJs.state.game.createdSounds.harp.play();\n\t    (0, _gameJs.playSong)('song');\n\t    fadeGame();\n\t    (0, _interfaceJs.openPage)('end1', false);\n\t}\n\t\n\tfunction introLevel1() {\n\t    if (_storeJs.state.playIntro) (0, _interfaceJs.openPage)('controls');else startLevel();\n\t}\n\t\n\tfunction introLevel2() {\n\t    localStorage.lastLevel = 1;\n\t    if (_storeJs.state.playIntro) {\n\t        (0, _interfaceJs.hideInterface)();\n\t        (0, _gameJs.stopSong)(1000);\n\t        _storeJs.state.game.createdSounds.darkSpell.play();\n\t        _storeJs.state.game.createdSounds.darkSpell.onStop.add(function () {\n\t            _storeJs.state.game.createdSounds.darkSpell.onStop.removeAll();\n\t            (0, _randPosJs.randomizePresencePositions)(_storeJs.state.position);\n\t            (0, _interfaceJs.openPage)('l2intro', false);\n\t            (0, _gameJs.playSong)('darkSong', 1000);\n\t        });\n\t    } else {\n\t        (0, _randPosJs.randomizePresencePositions)(_storeJs.state.position);\n\t        startLevel();\n\t    }\n\t}\n\t\n\tfunction fadeOutPositionalSounds() {\n\t    // Move player up so should not hear positional sounds.\n\t    var oldPos = _storeJs.state.position;\n\t    var posSetter = function posSetter(pos) {\n\t        return (0, _audioJs.setListenerPos)(_storeJs.state.game.sound.context, pos);\n\t    };\n\t    (0, _movementJs.tweenPos)(oldPos, [oldPos[0], oldPos[1], 10], posSetter, 1000, _storeJs.state, 'Move');\n\t}\n\t\n\tfunction wonLevel2() {\n\t    _storeJs.state.state = 'finished';\n\t    fadeOutPositionalSounds();\n\t    _storeJs.state.game.createdSounds.end2.play();\n\t    _storeJs.state.game.createdSounds.end2.onStop.add(function () {\n\t        _storeJs.state.game.createdSounds.end2.onStop.removeAll();\n\t        fadeGame(1000);\n\t        (0, _interfaceJs.openPage)('l2end1', false);\n\t        (0, _gameJs.playSong)('song');\n\t    });\n\t}\n\t\n\tfunction lostLevel2() {\n\t    _storeJs.state.game.createdSounds.rarr.play();\n\t    fadeGame(1000);\n\t    _storeJs.state.playIntro = false;\n\t    (0, _interfaceJs.openPage)('lost2', false, darkPresencePhrases[(0, _utilsJs.randInt)(darkPresencePhrases.length)]);\n\t    // game.sound.masterGain\n\t    fadeOutPositionalSounds();\n\t}\n\t\n\tfunction loadLevel(n) {\n\t    _storeJs.state.level = n;\n\t    _storeJs.state.position = [4, 4, 0];\n\t    _storeJs.state.followed = [];\n\t    _storeJs.state.power = [];\n\t    // loadVision(state)\n\t    if (n == 1) {\n\t        (0, _randPosJs.randomizePresencePositions)(_storeJs.state.position);\n\t        _storeJs.state.won = wonLevel1;\n\t        _storeJs.state.intro = introLevel1;\n\t        _storeJs.state.tint = 0xffffff;\n\t        _storeJs.state.filters = [];\n\t        _storeJs.state.onMoved = null;\n\t    } else if (n == 2) {\n\t        _storeJs.state.won = wonLevel2;\n\t        _storeJs.state.lost = lostLevel2;\n\t        _storeJs.state.intro = introLevel2;\n\t        _storeJs.state.tint = 0x202020;\n\t        _storeJs.state.filters = [_storeJs.state.game.createdFilters.gray];\n\t        _storeJs.state.onMoved = function () {\n\t            return (0, _movementJs.changeDarkPresencePos)(_storeJs.state.position, _gameJs.touchedDarkPresence);\n\t        };\n\t    }\n\t}\n\t\n\tfunction startLevel() {\n\t    (0, _interfaceJs.hideInterface)();\n\t    (0, _movementJs.initPlayerPos)();\n\t    (0, _createAudiosJs.createPositionedAudios)();\n\t    _storeJs.state.state = 'starting';\n\t    (0, _visionJs.loadVision)(_storeJs.state);\n\t}\n\t\n\tfunction pickLevel(n) {\n\t    var playSound = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];\n\t\n\t    loadLevel(n);\n\t    _storeJs.state.intro();\n\t    if (playSound) (0, _gameJs.playButtonSound)();\n\t}\n\n/***/ },\n/* 30 */\n/*!***********************!*\\\n  !*** ./src/loader.js ***!\n  \\***********************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports.mainLoad = mainLoad;\n\t\n\tvar _utilsJs = __webpack_require__(/*! ./utils.js */ 3);\n\t\n\tvar _movementJs = __webpack_require__(/*! ./movement.js */ 15);\n\t\n\tvar _interfaceJs = __webpack_require__(/*! ./interface.js */ 14);\n\t\n\tvar _inputJs = __webpack_require__(/*! ./input.js */ 28);\n\t\n\tvar _createAudiosJs = __webpack_require__(/*! ./createAudios.js */ 12);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tvar _gameJs = __webpack_require__(/*! ./game.js */ 13);\n\t\n\tvar _visionJs = __webpack_require__(/*! ./vision.js */ 7);\n\t\n\tvar _levelsJs = __webpack_require__(/*! ./levels.js */ 29);\n\t\n\tfunction mainLoad() {\n\t    _storeJs.state.game.load.onLoadComplete.add(function () {\n\t        _storeJs.state.game.load.onLoadComplete.removeAll();\n\t        mainInit();\n\t    }, this);\n\t\n\t    _storeJs.state.game.load.audio('button', ['assets/audio/button.ogg']);\n\t    _storeJs.state.game.load.audio('stream', ['assets/audio/stream_cold.ogg']);\n\t    _storeJs.state.game.load.audio('wind', ['assets/audio/wind.ogg']);\n\t    _storeJs.state.game.load.audio('fire', ['assets/audio/fire.ogg']);\n\t    _storeJs.state.game.load.audio('earth', ['assets/audio/earth.ogg']);\n\t    _storeJs.state.game.load.audio('magic', ['assets/audio/magic_slow.ogg']);\n\t    _storeJs.state.game.load.audio('magic_request', ['assets/audio/magic_request.ogg']);\n\t    _storeJs.state.game.load.audio('magic_arrived', ['assets/audio/magic_arrived.ogg']);\n\t    _storeJs.state.game.load.audio('magic_no', ['assets/audio/magic_no.ogg']);\n\t    _storeJs.state.game.load.audio('harp', ['assets/audio/harp.ogg']);\n\t    _storeJs.state.game.load.audio('harp_start', ['assets/audio/harp_start.ogg']);\n\t    _storeJs.state.game.load.audio('steps', ['assets/audio/steps.ogg']);\n\t    _storeJs.state.game.load.audio('dark_spell', ['assets/audio/dark_spell.ogg']);\n\t    _storeJs.state.game.load.audio('dark_presence', ['assets/audio/dark_presence.ogg']);\n\t    _storeJs.state.game.load.audio('dark_song', ['assets/audio/dark_song.ogg']);\n\t    _storeJs.state.game.load.audio('rarr', ['assets/audio/rarr.ogg']);\n\t    _storeJs.state.game.load.audio('end2', ['assets/audio/end2.ogg']);\n\t\n\t    _storeJs.state.game.load.script('gray', 'https://cdn.rawgit.com/photonstorm/phaser/master/filters/Gray.js');\n\t\n\t    var firstImg = (0, _utilsJs.posDirToText)(_storeJs.state.position, _storeJs.state.direction);\n\t    _storeJs.state.game.load.image(firstImg, 'assets/map/' + firstImg + '.jpg');\n\t\n\t    _storeJs.state.game.load.start();\n\t    console.log('Loading...');\n\t}\n\t\n\t// First init called. Should be called only once, and before any level.\n\tfunction mainInit() {\n\t    console.log('Done loading');\n\t    (0, _interfaceJs.hideLoadingScreen)();\n\t\n\t    _storeJs.state.game.stage.backgroundColor = '#000000';\n\t    // Used to render some things always in front of others\n\t    _storeJs.state.layers = {\n\t        back: _storeJs.state.game.add.group(),\n\t        front: _storeJs.state.game.add.group()\n\t    };\n\t\n\t    _storeJs.state.onSetVision = _gameJs.onSetVision;\n\t    (0, _visionJs.resize)();\n\t\n\t    // initialize state presences (needed to later randomize them)\n\t    for (var k in _storeJs.shrines) {\n\t        _storeJs.state.presences[k] = {};\n\t    }\n\t\n\t    _storeJs.state.game.createdFilters = { gray: _storeJs.state.game.add.filter('Gray') };\n\t    (0, _createAudiosJs.createCommonAudios)();\n\t    (0, _inputJs.initKeyboardInput)(_movementJs.move, _gameJs.interact);\n\t    (0, _inputJs.initMouseInput)(_movementJs.move, _gameJs.interact);\n\t\n\t    if (!localStorage.getItem('lastLevel')) {\n\t        // No level unlocked\n\t        (0, _levelsJs.pickLevel)(1, false);\n\t    } else {\n\t        // Level 2 unlocked\n\t        (0, _interfaceJs.openPage)('mainmenu', false);\n\t    }\n\t}\n\t\n\t// Exported functions, so interface can call them\n\twindow.playButtonSound = _gameJs.playButtonSound;\n\twindow.pickLevel = _levelsJs.pickLevel;\n\twindow.startLevel = _levelsJs.startLevel;\n\n/***/ },\n/* 31 */\n/*!************************!*\\\n  !*** ./src/randPos.js ***!\n  \\************************/\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\t\n\tvar _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();\n\t\n\texports.randomizePresencePositions = randomizePresencePositions;\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\t\n\tvar _assetsMapMapJs = __webpack_require__(/*! ../assets/map/map.js */ 21);\n\t\n\tvar _assetsMapMapJs2 = _interopRequireDefault(_assetsMapMapJs);\n\t\n\tvar _utilsJs = __webpack_require__(/*! ./utils.js */ 3);\n\t\n\tvar _storeJs = __webpack_require__(/*! ./store.js */ 1);\n\t\n\tfunction randomizePresencePositions(player_pos) {\n\t    var possible_pos = {};\n\t    var array_pos = [];\n\t\n\t    // No presence arrived yet\n\t    for (var p in _storeJs.state.presences) {\n\t        _storeJs.state.presences[p].arrived = false;\n\t    } // copy all map positions\n\t    for (var k in _assetsMapMapJs2['default']) {\n\t        possible_pos[k] = true;\n\t    } // remove positions too close to player position\n\t    deleteCube(possible_pos, player_pos, 1);\n\t\n\t    // remove positions too close to shrines\n\t    for (var k in _storeJs.shrines) {\n\t        deleteCube(possible_pos, _storeJs.shrines[k].position, 2);\n\t    }\n\t\n\t    // place the dark presence\n\t    if (_storeJs.state.level == 2) {\n\t        array_pos = Object.keys(possible_pos);\n\t        _storeJs.state.darkPresence.position = (0, _utilsJs.textToPos)(array_pos[(0, _utilsJs.randInt)(array_pos.length)]);\n\t    } else {\n\t        _storeJs.state.darkPresence.position = [100, 100, 100];\n\t    }\n\t\n\t    // place presences\n\t    // Placing presences may fail for when one is placed, the others\n\t    // have less space to be placed. Try again sometimes if failed.\n\t    var failed = false;\n\t    var remainingAttempts = 10;\n\t    do {\n\t        var remaining_pos = Object.assign({}, possible_pos);\n\t        for (var k in _storeJs.shrines) {\n\t            // convert to array so can random pick an index\n\t            array_pos = Object.keys(remaining_pos);\n\t            // check if still has positions to use\n\t            if (!array_pos.length) {\n\t                // no positions left, try again?\n\t                failed = true;\n\t                console.log('ops...');\n\t            } else {\n\t                // random choice\n\t                var pos = (0, _utilsJs.textToPos)(array_pos[(0, _utilsJs.randInt)(array_pos.length)]);\n\t                // set presence to pos\n\t                _storeJs.state.presences[k].position = pos;\n\t                // remove positions too close to presence\n\t                deleteCube(remaining_pos, pos, 2);\n\t            }\n\t        }\n\t        remainingAttempts--;\n\t    } while (failed && remainingAttempts);\n\t\n\t    if (failed) {\n\t        console.log('OMG! I failed! =O');\n\t    }\n\t}\n\t\n\tfunction deleteCube(obj, center, radius) {\n\t    var _center = _slicedToArray(center, 3);\n\t\n\t    var xc = _center[0];\n\t    var yc = _center[1];\n\t    var zc = _center[2];\n\t\n\t    for (var i = xc - radius; xc + radius >= i; i++) {\n\t        for (var j = yc - radius; yc + radius >= j; j++) {\n\t            for (var k = zc - radius; zc + radius >= k; k++) {\n\t                delete obj[(0, _utilsJs.posToText)([i, j, k])];\n\t            }\n\t        }\n\t    }\n\t}\n\n/***/ },\n/* 32 */,\n/* 33 */,\n/* 34 */,\n/* 35 */,\n/* 36 */,\n/* 37 */,\n/* 38 */,\n/* 39 */,\n/* 40 */,\n/* 41 */,\n/* 42 */,\n/* 43 */,\n/* 44 */,\n/* 45 */,\n/* 46 */,\n/* 47 */,\n/* 48 */,\n/* 49 */,\n/* 50 */,\n/* 51 */,\n/* 52 */,\n/* 53 */,\n/* 54 */,\n/* 55 */,\n/* 56 */,\n/* 57 */\n/*!************************************************!*\\\n  !*** ./~/text-loader!./src/pages/cantsee.html ***!\n  \\************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>But here comes the tricky part: you can't see the presences. You can only hear them.\\n    And that is also how you'll need to find out which presence belongs to which shrine.</p>\\n<p>One last tip: once you gain the power to communicate with a presence, you lose the power to communicate with the others.</p>\\n<a onClick=\\\"window.openPage('instructions')\\\">Back</a>\\n<a onClick=\\\"window.startLevel()\\\">Ok! Here I go!</a>\\n\"\n\n/***/ },\n/* 58 */\n/*!*************************************************!*\\\n  !*** ./~/text-loader!./src/pages/controls.html ***!\n  \\*************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>In this game you will need to be guided by sounds. So a headphone is <b>highly</b> recommended.</p>\\n<p>It's also <b>highly</b> recommended to play it using a recent Firefox or Chromium/Chrome. Firefox seems to play the sounds better.</p>\\n<p>Use the <b>arrow keys</b> to walk and the <b>spacebar</b> to interact.\\nOr click or touch the top/bottom parts of the screen to walk forward/backward and the left/right to rotate. Click/tap the middle of the screen to interact.</p>\\n<a onClick=\\\"window.openPage('instrorstart')\\\">Ok</a>\\n\"\n\n/***/ },\n/* 59 */\n/*!************************************************!*\\\n  !*** ./~/text-loader!./src/pages/credits.html ***!\n  \\************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>This is a free software game!</p>\\n<p>Made by: Andrés M. R. Martano</p>\\n<p>Based on works from many others.</p>\\n\\n<ul>\\n  <li>\\n    <a href=\\\"https://github.com/andresmrm/labyrimental\\\" target=\\\"_blank\\\">Check full credits and source repository.</a>\\n  </li>\\n  <li>\\n    <a onClick=\\\"window.openPage('mainmenu')\\\">Main menu</a>\\n  </li>\\n<ul>\\n\"\n\n/***/ },\n/* 60 */\n/*!*********************************************!*\\\n  !*** ./~/text-loader!./src/pages/end1.html ***!\n  \\*********************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Wow! Congratulations!</p>\\n<p>You helped the presenses! They are very grateful!</p>\\n<a onClick=\\\"window.pickLevel(2)\\\">Yay!</a>\\n\"\n\n/***/ },\n/* 61 */\n/*!************************************************!*\\\n  !*** ./~/text-loader!./src/pages/history.html ***!\n  \\************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>This magic labyrinth has four elemental shrines, each inhabited by an elemental presence.\\nA powerfull spell casted nearby shaked the land, confusing the presences and spreading them around the labyrinth. Now they need your help to guide them back to their shrines.</p>\\n<a onClick=\\\"window.openPage('instructions')\\\">Next</a>\\n\"\n\n/***/ },\n/* 62 */\n/*!*****************************************************!*\\\n  !*** ./~/text-loader!./src/pages/instrorstart.html ***!\n  \\*****************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Do you want to read the instructions or find out how to play by yourself?</p>\\n<a onClick=\\\"window.openPage('history')\\\">I don't want to guess how to play this weird game. Show me the instructions.</a>\\n<a onClick=\\\"window.startLevel()\\\">Challenge is my second name. Just start the game.</a>\\n\"\n\n/***/ },\n/* 63 */\n/*!*****************************************************!*\\\n  !*** ./~/text-loader!./src/pages/instructions.html ***!\n  \\*****************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Before you can help one of the presences, you need to visit her shrine. There you will gain the power to communicate with her. After that you need to find the presence around the labyrinth, stay very close and interact, calling her to follow you. Then you can bring her back to her shrine.</p>\\n<a onClick=\\\"window.openPage('history')\\\">Back</a>\\n<a onClick=\\\"window.openPage('cantsee')\\\">Next</a>\\n\"\n\n/***/ },\n/* 64 */\n/*!***********************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2end1.html ***!\n  \\***********************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>We did it! United the elemental presences could communicate with the dark presence and lessen her anger.</p>\\n<a onClick=\\\"window.openPage('l2end2')\\\">Great!</a>\\n\"\n\n/***/ },\n/* 65 */\n/*!***********************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2end2.html ***!\n  \\***********************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>It seems she's angry because of the powerfull spells casted and she thought you're the one responsible for them.</p>\\n<p>Maybe it's time to find out who is behind all this...</p>\\n<a onClick=\\\"window.openPage('l2end3')\\\">...</a>\\n\"\n\n/***/ },\n/* 66 */\n/*!***********************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2end3.html ***!\n  \\***********************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Continue?</p>\\n<a onClick=\\\"window.openPage('credits')\\\">End</a>\\n\"\n\n/***/ },\n/* 67 */\n/*!************************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2intro.html ***!\n  \\************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Uh oh...</p>\\n<a onClick=\\\"window.openPage('l2intro2')\\\">WHAT WAS THAT?</a>\\n<a onClick=\\\"window.openPage('l2intro2')\\\">Not again...</a>\\n\"\n\n/***/ },\n/* 68 */\n/*!*************************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2intro2.html ***!\n  \\*************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>It seems a powerfull spell was casted again. But this time, it unleashed a... dark presence.</p>\\n<p>What are we going to do now?</p>\\n<a onClick=\\\"window.openPage('l2intro3')\\\">Hey! You're the one supposed to tell me that!</a>\\n<a onClick=\\\"window.startLevel()\\\">Just stay out of the way and I'll solve it quick.</a>\\n\"\n\n/***/ },\n/* 69 */\n/*!*************************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2intro3.html ***!\n  \\*************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Hum... Ok... Don't panic.</p>\\n<p>After the powerfull spell was casted again, the four elemental presences should be spread across the labyrinth once again. But maybe, if you can unite them, they can do something about it.</p>\\n<a onClick=\\\"window.openPage('l2intro3a')\\\">They can't even find the way back to their shines!</a>\\n<a onClick=\\\"window.openPage('l2intro4')\\\">Ok...</a>\\n\"\n\n/***/ },\n/* 70 */\n/*!**************************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2intro3a.html ***!\n  \\**************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Hey! Don't underestimate the presences! Besides, I have no other idea...</p>\\n<a onClick=\\\"window.openPage('l2intro4')\\\">Great...</a>\\n\"\n\n/***/ },\n/* 71 */\n/*!*************************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2intro4.html ***!\n  \\*************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Ok, so first you'll need to enter each of the four shines again, to gain the hability to communicate with each presence. This time, given the circustances, you should be able to accumulate the power to communicate with all of them at the same time. Then find them around the labyrinth.</p>\\n<a onClick=\\\"window.openPage('l2intro5')\\\">...</a>\\n\"\n\n/***/ },\n/* 72 */\n/*!*************************************************!*\\\n  !*** ./~/text-loader!./src/pages/l2intro5.html ***!\n  \\*************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Be cautious: don't face the dark presence before you have all the four elemental presences with you. Like the others, you can't see the dark presence, but I'm sure you'll know when she is close. Run. And don't forget: she can pass through walls and she seems ANGRY.</p>\\n<a onClick=\\\"window.startLevel()\\\">...</a>\\n\"\n\n/***/ },\n/* 73 */\n/*!**********************************************!*\\\n  !*** ./~/text-loader!./src/pages/lost2.html ***!\n  \\**********************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>{{}}</p>\\n<ul>\\n  <li>\\n    <a onClick=\\\"window.pickLevel(2)\\\">Restart</a>\\n  </li>\\n  <li>\\n    <a onClick=\\\"window.openPage('mainmenu')\\\">Main menu</a>\\n  </li>\\n<ul>\\n\"\n\n/***/ },\n/* 74 */\n/*!*************************************************!*\\\n  !*** ./~/text-loader!./src/pages/mainmenu.html ***!\n  \\*************************************************/\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<p>Select a level:</p>\\n<ul>\\n  <li>\\n    <a onClick=\\\"window.pickLevel(1)\\\">Level 1</a>\\n  </li>\\n  <li>\\n    <a onClick=\\\"window.pickLevel(2)\\\">Level 2</a>\\n  </li>\\n<ul>\\n\"\n\n/***/ }\n]);\n\n\n/** WEBPACK FOOTER **\n ** app.js\n **/","import {mainLoad} from './loader.js'\nimport {playSong} from './game.js'\nimport {state} from './store.js'\n\nfunction preload() {\n    // TODO: Tirar isso?\n    state.game.stage.disableVisibilityChange = true\n\n    state.game.load.audio('song', ['assets/audio/song.ogg'])\n}\n\nfunction create() {\n    var song = state.game.add.audio('song', 1, true)\n    state.game.sound.setDecodedCallback([song], () => playSong('song'), this)\n    state.game.createdSounds = {song}\n    mainLoad()\n}\n\nfunction update() {\n}\n\nstate.game = new Phaser.Game(0, 0, Phaser.AUTO, 'app',\n                           { preload: preload,\n                             create: create,\n                             update: update })\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","export var shrines = {\n    water: {\n        position: [10, 0, 0],\n        walkablePos: [9, 0, 0],\n        soundName: 'stream',\n        gain: 15,\n        // color: 0x0000ff,\n        color: 0x00376e,\n    },\n    earth: {\n        position: [8, 10, 0],\n        walkablePos: [8, 9, 0],\n        soundName: 'earth',\n        gain: 2,\n        // color: 0xa16020,\n        color: 0x376e00,\n    },\n    air: {\n        position: [0, -2, 0],\n        walkablePos: [0, -1, 0],\n        soundName: 'wind',\n        gain: 4,\n        // color: 0xaaaaaa,\n        color: 0x3a0371,\n    },\n    fire: {\n        position: [-2, 7, 0],\n        walkablePos: [-1, 7, 0],\n        soundName: 'fire',\n        gain: 4,\n        // color: 0xff0000,\n        color: 0x6e3700,\n    }\n}\n\nexport var state = {\n    state: 'pregame',\n    level: 1,\n    position: [4, 4, 0],\n    direction: 'e',\n    followed: [],\n    presences: {},\n    darkPresence: {},\n    power: [],\n    filters: [],\n    tint: null,\n    // if is waiting the load of an image for the vision\n    loadingVision: false,\n    // if should play intro or skip it\n    playIntro: true,\n    // current playing or last played song\n    currentSong: null,\n}\n\n\n// Debug TODO: remover?\nwindow.s = state\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/store.js\n **/","var directions = ['n', 'e', 's', 'w']\n\n// Return a random int from 0 to x-1\nexport function randInt(x) {\n    return Math.floor(Math.random() * (x))\n}\n\n// Check if two arrays have the same numbers in the same order\nexport function equalArrays(a1, a2) {\n    var equal = true\n    for (let i in a1) {\n        if (a1[i] != a2[i]) {\n            equal = false\n            break\n        }\n    }\n    return equal\n}\n\n// Converts a text to a position. e.g.: '2_4_5' -> [2,4,5]\nexport function textToPos(t) {\n    return t.split('_').map((x)=>parseInt(x))\n}\n\n// Converts a position to text. e.g.: [2,4,5] -> '2_4_5'\nexport function posToText(pos) {\n    return pos.join('_')\n}\n\n// Converts a position and a direction to text. e.g.: [2,4,5], 'n' -> '2_4_5_n'\nexport function posDirToText(pos, direction) {\n    return posToText(pos) + '_' + direction\n}\n\n// Returns eclidean distance between 2 positions\nexport function posDist(p1, p2) {\n    return Math.sqrt(Math.pow(p1[0] - p2[0], 2) +\n                     Math.pow(p1[1] - p2[1], 2) +\n                     Math.pow(p1[2] - p2[2], 2))\n}\n\n// Returns a rotated direction to the left\nexport function rotLeft(dir) {\n    if (dir == 'n') return 'w'\n    else return directions[directions.indexOf(dir) - 1]\n}\n\n// Returns a rotated direction to the right\nexport function rotRight(dir) {\n    if (dir == 'w') return 'n'\n    else return directions[directions.indexOf(dir) + 1]\n}\n\n// Returns the oposite direction\nexport function rot180(dir) {\n    return rotLeft(rotLeft(dir))\n}\n\nexport function getBounds(obj) {\n    return [obj.x, obj.y, obj.width, obj.height]\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils.js\n **/","import {posDirToText, getBounds} from './utils.js'\nimport {setInterfaceBounds} from './interface.js'\nimport {state} from './store.js'\n\n\nfunction setVision(isResize=false) {\n    if (!isResize) state.loadingVision = false\n\n    if (state.img) state.img.destroy()\n    state.img = state.game.add.image(0, 0, posDirToText(state.position, state.direction))\n    state.layers.back.add(state.img)\n    var r = Math.min(state.game.width/state.img.width, state.game.height/state.img.height)\n    state.img.scale.setTo(r)\n    state.img.x = (state.game.width - state.img.width) / 2\n    state.img.y = (state.game.height - state.img.height) / 2\n\n    // Round bounds\n    var bounds = ['x', 'y', 'width', 'height']\n    bounds.map((key) => state.img[key] = Math.round(state.img[key]))\n\n    // Set tint\n    if (state.tint) state.img.tint = state.tint\n    // Set filter\n    if (state.filters.length) state.img.filters = state.filters\n\n    // Map img bounds to interface\n    setInterfaceBounds(getBounds(state.img))\n\n    // Enable mouse move\n    if (state.onTap) {\n        state.img.inputEnabled = true\n        state.img.events.onInputUp.add(state.onTap, this)\n    }\n\n    if (state.onSetVision) state.onSetVision(isResize)\n}\n\nexport function addEffect(state, color, alpha) {\n    if (state.effect) state.effect.destroy()\n    state.effect = state.game.add.graphics(0, 0)\n    state.effect.beginFill(color, alpha)\n    state.effect.drawRect(state.img.x, state.img.y, state.img.width, state.img.height)\n    state.effect.endFill()\n    state.layers.front.add(state.effect)\n    return state.effect\n}\n\nexport function loadVision(state) {\n    var s = posDirToText(state.position, state.direction)\n    if (!state.game.cache.checkImageKey(s)) {\n        state.loadingVision = true\n        state.game.load.image(s, 'assets/map/' + s + '.jpg').onFileComplete.add(() => setVision())\n        state.game.load.start()\n    } else {\n        setVision()\n    }\n}\n\nexport function resize() {\n    state.game.scale.setGameSize(window.innerWidth, window.innerHeight)\n    setVision(true)\n}\n\n// Resizes game on window resize\n// based on: http://www.html5gamedevs.com/topic/13900-doubt-about-making-my-game-responsive-on-onresize/\n// The delay is supposed to help on some devices\nwindow.addEventListener('resize',\n                        () => state.game.time.events.add(200, resize),\n                        false)\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/vision.js\n **/","var audioMult = 1\n\nexport function setListenerPos(context, pos) {\n    // The +1 avoids 0 distance. It hurts the ears.\n    context.listener.setPosition(pos[0] * audioMult, pos[2] + 1, - pos[1] * audioMult)\n}\n\nexport function setAudioOri(context, direction) {\n    var [x, y, z] = direction\n    context.listener.setOrientation(x, z, -y, 0, 1, 0)\n}\n\nexport function setPannerPos(panner, pos) {\n    var [x, y, z] = pos\n    panner.setPosition(x * audioMult, z * audioMult, - y * audioMult)\n}\n\nexport function addSound(game, position, soundName, soundGain=1) {\n    var audio = game.add.audio(soundName)\n    var panner = game.sound.context.createPanner()\n\n    panner.panningModel = 'HRTF'\n    panner.distanceModel = 'exponential'\n    panner.refDistance = 1\n    panner.maxDistance = 4\n    panner.rolloffFactor = 4\n\n    audio.gainNode.disconnect()\n    audio.gainNode.connect(panner)\n\n    // panner.connect(game.sound.masterGain)\n    var volume = game.sound.context.createGain()\n    panner.connect(volume)\n    volume.connect(game.sound.masterGain)\n    volume.gain.value = soundGain\n\n    setPannerPos(panner, position)\n    audio.loop = true\n    audio.play()\n\n    return {audio, panner, volume}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/audio.js\n **/","import {addSound, setPannerPos} from './audio.js'\nimport {shrines, state} from './store.js'\n\n\nexport function createCommonAudios() {\n    // steps sound\n    var steps = state.game.add.audio('steps')\n    steps.allowMultiple = true\n    for (let i = 0; i < 6; i++) {\n        steps.addMarker(i, i, 1)\n    }\n\n    // more sounds\n    Object.assign(state.game.createdSounds, {\n        steps,\n        harp: state.game.add.audio('harp', 0.8),\n        harpStart: state.game.add.audio('harp_start', 0.8),\n        button: state.game.add.audio('button', 0.5),\n        magic: state.game.add.audio('magic'),\n        magicNo: state.game.add.audio('magic_no'),\n        magicRequest: state.game.add.audio('magic_request'),\n        magicArrived: state.game.add.audio('magic_arrived'),\n        darkSpell: state.game.add.audio('dark_spell', 1.5),\n        darkSong: state.game.add.audio('dark_song', 1, true),\n        darkPresence: state.game.add.audio('dark_presence', 1, true),\n        rarr: state.game.add.audio('rarr'),\n        end2: state.game.add.audio('end2'),\n    })\n}\n\nexport function createPositionedAudios() {\n    for (let k in shrines) {\n        var shrine = shrines[k]\n        // Add shrine\n        if (!shrine.sound)\n            shrine.sound =\n                addSound(state.game, shrine.position,\n                        shrine.soundName, shrine.gain)\n\n        var presence = state.presences[k]\n        // Add presence\n        if (!presence.sound) {\n            presence.sound =\n                addSound(state.game, presence.position,\n                         shrine.soundName, shrine.gain)\n        } else {\n            setPannerPos(presence.sound.panner, presence.position)\n        }\n        changePresenceSoundGain(k, 1)\n    }\n\n    // Dark Presence\n    if (state.level == 2) {\n        var darkPres = state.darkPresence\n        if (!darkPres.sound) {\n            state.darkPresence.sound =\n                addSound(state.game, darkPres.position,\n                         'dark_presence', 1.5)\n        } else {\n            setPannerPos(darkPres.sound.panner, darkPres.position)\n            state.darkPresence.sound.volume.gain.value = 1\n        }\n    } else {\n        if (state.darkPresence.sound) {\n            state.darkPresence.sound.volume.gain.value = 0\n        }\n    }\n}\n\nexport function changePresenceSoundGain(presenceName, mult) {\n    state.presences[presenceName].sound.volume.gain.value =\n        shrines[presenceName].gain * mult\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/createAudios.js\n **/","import {equalArrays} from './utils.js'\nimport {changePresencePos} from './movement.js'\nimport {addEffect} from './vision.js'\nimport {shrines, state} from './store.js'\nimport {changePresenceSoundGain} from './createAudios.js'\n\n\nexport function playSong(name, fadeInTime=2000) {\n    if (state.currentSong) state.currentSong.stop()\n    state.currentSong = state.game.createdSounds[name]\n    state.currentSong.fadeIn(fadeInTime, true, '')\n}\n\nexport function stopSong(fadeOutTime=2000) {\n    if (state.currentSong && state.currentSong.isPlaying)\n        state.currentSong.fadeOut(fadeOutTime)\n}\n\n\nexport function touchedDarkPresence() {\n    if (state.followed.length == 4) state.won()\n    else state.lost()\n}\n\nexport function onSetVision(isResize) {\n\n    // Make sure that the song won't play in game.\n    if (state.state == 'playing') stopSong()\n\n    // Effects\n    if (['pregame', 'starting'].includes(state.state)) {\n        addEffect(state, 0x000000, 1)\n        if (state.state == 'starting') {\n            state.state = 'playing'\n            stopSong()\n            state.game.add.tween(state.effect)\n                .to({alpha: 0}, 2000, \"Linear\", true)\n            if (!isResize) {\n                if (state.level == 1) state.game.createdSounds.harpStart.play()\n            }\n        }\n    }\n\n\n    // var tweenBack = state.game.add.tween(effect).to( { alpha: 0 }, 1000, \"Linear\")\n    // tweenTo.chain(tweenBack)\n    // tweenTo.start()\n\n\n    if (!isResize) {\n        checkFollowPresence()\n        checkInShrine()\n    }\n}\n\nexport function interact() {\n    if (state.state == 'playing') {\n        var presence = isInPresence(state.position)\n        if (presence &&\n            state.power.includes(presence) &&\n            !state.presences[presence].arrived) {\n\n            if (state.level == 2 || !state.followed.length) {\n                // presence starts to follow player\n                state.followed.push(presence)\n                changePresenceSoundGain(presence, 0.25)\n                state.game.createdSounds.magicRequest.play()\n                if (state.level == 2) {\n                    // Gain color!\n                    state.tint += shrines[presence].color\n                    if (state.filters.length) state.filters = []\n                }\n                return true\n            }\n        }\n        state.game.createdSounds.magicNo.play()\n    }\n\n    return false\n}\n\nfunction checkFollowPresence() {\n    // if (state.followed) {\n    for (let p of state.followed) {\n        changePresencePos(state.presences[p], state.position, 2000)\n    }\n    // }\n}\n\n// Check if is in a different shrine and set player power\nfunction checkInShrine() {\n    var shrine = isInShrine(state.position)\n    if (shrine) {\n        if (state.level == 1) {\n            // If not followed and entering a shrine of different power\n            // that still hasn't its presence\n            if (!state.followed.length &&\n                !state.presences[shrine].arrived) {\n                var newPower = true\n                if (state.power.length && state.power[0] == shrine) newPower = false\n                if (newPower) setPower(shrine, true)\n            // If followed by presence of the current shrine\n            } else if (state.followed.includes(shrine)) {\n                presenceArrived(state, shrine)\n            }\n        } else {\n            if (!state.power.includes(shrine)) setPower(shrine)\n        }\n    }\n}\n\nfunction presenceArrived(state, presence) {\n    state.presences[presence].arrived = true\n    changePresenceSoundGain(presence, 1)\n    // Pop presence from followed\n    state.followed.splice(state.followed.indexOf(presence), 1)\n    // Pop power\n    state.power.splice(state.power.indexOf(presence), 1)\n    state.game.createdSounds.magicArrived.play()\n\n    // If all presences arrived: The end!\n    if (Object.keys(state.presences).reduce(\n        (p, c) => p && state.presences[c].arrived, true)) {\n        state.game.createdSounds.magicArrived.onStop.add(\n            function () {\n                state.won()\n                state.game.createdSounds.magicArrived.onStop.removeAll()\n            }\n        )\n    }\n}\n\n// Set player power and display effect/sound\nfunction setPower(power, replace=false) {\n    if (replace) state.power = []\n    state.power.push(power)\n\n    // visual effect when entering a different shrine\n    var effect = addEffect(state, shrines[power].color, 0.5)\n    effect.alpha = 0\n    var tweenTo = state.game.add.tween(effect).to( { alpha: 1 }, 1000, \"Linear\")\n    var tweenBack = state.game.add.tween(effect).to( { alpha: 0 }, 1000, \"Linear\")\n    tweenTo.chain(tweenBack)\n    tweenTo.start()\n    state.game.createdSounds.magic.play()\n    tweenBack.onComplete.add(() => effect.destroy())\n}\n\n// check if position is the same of a shrine\nfunction isInShrine(position) {\n    for (let k in shrines) {\n        if (equalArrays(position, shrines[k].walkablePos)) return k\n    }\n    return null\n}\n\n// check if position is the same of a presence\nfunction isInPresence(position) {\n    for (let k in state.presences) {\n        if (equalArrays(position, state.presences[k].position) &&\n            !state.followed.includes(k))\n            return k\n    }\n    return null\n}\n\nexport function playButtonSound() {\n    state.game.createdSounds.button.play()\n}\n\n// function createGameElements() {\n//     console.log('Creating...')\n\n//     // state.game.createdSounds.song.stop()\n//     // hideInterface()\n//     // startLevel()\n//     // setTimeout(function () {\n//     //     for (let p in state.presences) {\n//     //         state.followed = p\n//     //         presenceArrived(state)\n//     //     }\n//     // }, 2000)\n\n\n\n//     // setTimeout(function () {\n//     //     // TODO: tratar melhor qual música para/toca\n//     //     state.game.createdSounds.song.stop()\n//     //     // loadLevel2()\n//     //     // toLevel2intro()\n//     // }, 2000)\n\n//     // loadLevel2()\n//     // randomizePresencePositions(state.position)\n//     // startLevel()\n\n//     // openPage('controls', false)\n//     // openPage('instrorstart', false)\n\n//     // Debug\n//     // state.effect2 = state.game.add.graphics(0, 0)\n//     // state.effect2.beginFill(0xff0000, 1)\n//     // state.effect2.drawRect(0, 0, 10, 10)\n//     // state.effect2.endFill()\n// }\n\n\nfunction cheatLevel1() {\n    for (let p in state.presences) {\n        state.followed.push(p)\n        presenceArrived(state, p)\n    }\n}\nfunction cheatLevel2() {\n    for (let p in state.presences) {\n        state.followed.push(p)\n    }\n    // touchedDarkPresence()\n}\nwindow.cheats = {\n    l1: cheatLevel1,\n    l2: cheatLevel2\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/game.js\n **/","var pages = {\n    mainmenu: require(\"text!./pages/mainmenu.html\"),\n    controls: require(\"text!./pages/controls.html\"),\n    instructions: require(\"text!./pages/instructions.html\"),\n    instrorstart: require(\"text!./pages/instrorstart.html\"),\n    history: require(\"text!./pages/history.html\"),\n    cantsee: require(\"text!./pages/cantsee.html\"),\n    end1: require(\"text!./pages/end1.html\"),\n    l2intro: require(\"text!./pages/l2intro.html\"),\n    l2intro2: require(\"text!./pages/l2intro2.html\"),\n    l2intro3: require(\"text!./pages/l2intro3.html\"),\n    l2intro3a: require(\"text!./pages/l2intro3a.html\"),\n    l2intro4: require(\"text!./pages/l2intro4.html\"),\n    l2intro5: require(\"text!./pages/l2intro5.html\"),\n    lost2: require(\"text!./pages/lost2.html\"),\n    l2end1: require(\"text!./pages/l2end1.html\"),\n    l2end2: require(\"text!./pages/l2end2.html\"),\n    l2end3: require(\"text!./pages/l2end3.html\"),\n    credits: require(\"text!./pages/credits.html\"),\n}\n\nfunction getDiv(outer=false) {\n    if (outer) return document.getElementById('interface-outer')\n    else return document.getElementById('interface')\n}\n\nexport function setInterfaceBounds(bounds) {\n    var outer = getDiv(true)\n    bounds.map(\n            function (val, index) { outer.style[this[index]] = val + 'px'},\n            [\"left\", \"top\", \"width\", \"height\"])\n\n    getDiv().style.padding = `${bounds[2]/8}px ${bounds[3]/8}px`\n}\n\nexport function openPage(name, playSound=true, replace=null) {\n    showInterface()\n    var text = pages[name]\n    if (replace)\n        text = text.replace('{{}}', replace)\n    getDiv().innerHTML = `<div class=\"page\">${text}</div>`\n    if (playSound) window.playButtonSound()\n    window.scrollTo(0, 0)\n}\n\nexport function showInterface() {\n    var inter = getDiv()\n    inter.style.zIndex = 1\n    inter.style.opacity = 1\n    var outer = getDiv(true)\n    outer.style.pointerEvents = 'auto'\n}\n\nexport function hideInterface() {\n    var inter = getDiv()\n    inter.style.zIndex = -1\n    inter.style.opacity = 0\n    inter.innerHTML = ''\n    var outer = getDiv(true)\n    outer.style.pointerEvents = 'none'\n}\n\nexport function hideLoadingScreen() {\n    var el = document.getElementById('loading-screen')\n    if (el) el.parentNode.removeChild(el)\n}\n\nwindow.openPage = openPage\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/interface.js\n **/","import map from '../assets/map/map.js'\nimport {randInt, posToText, posDist, getBounds, rotLeft, rotRight, rot180} from './utils.js'\nimport {setListenerPos, setAudioOri, setPannerPos} from './audio.js'\nimport {loadVision} from './vision.js'\nimport {state} from './store.js'\n\n\nvar walk = {\n    e: [1, 0, 0],\n    s: [0, -1, 0],\n    w: [-1, 0, 0],\n    n: [0, 1, 0],\n}\n\n\nfunction tryChangePos(direction) {\n    let newPos = map[posToText(state.position)][direction]\n    if (newPos) {\n        var oldPos = state.position\n        state.position = newPos\n        var posSetter = (pos) => setListenerPos(state.game.sound.context, pos)\n        tweenPos(oldPos, newPos, posSetter, 500, state, 'Move')\n        state.game.createdSounds.steps.play(randInt(5))\n        return true\n    }\n    return false\n}\n\nexport function changeDarkPresencePos(playerPos, fTouched) {\n    var oldPos = state.darkPresence.position\n    var posSetter = (pos) => {\n        if (state.state == 'playing') {\n            setPannerPos(state.darkPresence.sound.panner, pos)\n            state.darkPresence.position = pos\n            // state.effect2.x = pos[0] * 50\n            // state.effect2.y = pos[1] * 50\n            if (posDist(pos, state.position) < 0.5 && fTouched) fTouched()\n        }\n    }\n    var time = posDist(oldPos, playerPos) * 2500\n    tweenPos(oldPos, playerPos, posSetter, time, state.darkPresence)\n}\n\nexport function move(event, key) {\n    if (state.state == 'playing' && !state.loadingVision\n        /*&& noRecentMove(state, 1000)*/) {\n        var moved = false\n        var rotated = false\n        switch (key) {\n        case 'UP':\n            moved = tryChangePos(state.direction)\n            break\n        case 'DOWN':\n            moved = tryChangePos(rot180(state.direction))\n            break\n        case 'LEFT':\n            rotatePlayer(state, 'left')\n            rotated = true\n            break\n        case 'RIGHT':\n            rotatePlayer(state, 'right')\n            rotated = true\n            break\n        }\n        // checkTeleportation(state)\n        if (rotated || moved) loadVision(state)\n        if (moved && state.onMoved) state.onMoved()\n    }\n}\n\nfunction rotatePlayer(state, type) {\n    var oldPos = walk[state.direction]\n    if (type == 'left') state.direction = rotLeft(state.direction)\n    else state.direction = rotRight(state.direction)\n    var newPos = walk[state.direction]\n    var posSetter = (pos) => setAudioOri(state.game.sound.context, pos)\n    tweenPos(oldPos, newPos, posSetter, 500, state, 'Rotate')\n}\n\nexport function changePresencePos(presence, newPos, time) {\n    var oldPos = presence.position\n    presence.position = newPos\n    var posSetter = (pos) => setPannerPos(presence.sound.panner, pos)\n    tweenPos(oldPos, newPos, posSetter, time, presence)\n}\n\n// Tween a position running posSetter on each interaction.\n// Store tween in 'store', use 'tween'+extraName to name the pointer.\nexport function tweenPos(oldPos, newPos, posSetter, time, store, extraName) {\n    var [ox, oy, oz] = oldPos\n    var [nx, ny, nz] = newPos\n    var obj = {x:ox, y:oy, z:oz}\n    var tweenTo = state.game.add.tween(obj).to({x:nx, y:ny, z:nz}, time, \"Linear\")\n    var updateFunc = () => posSetter([obj.x, obj.y, obj.z])\n    tweenTo.onUpdateCallback(updateFunc)\n    tweenTo.onComplete.add(updateFunc)\n    tweenTo.start()\n    // Remove old tween, save pointer to new tween\n    if (store) {\n        var name = 'tween'\n        if (extraName) name += extraName\n        if (store[name]) store[name].stop()\n        store[name] = tweenTo\n    }\n}\n\nexport function initPlayerPos() {\n    setListenerPos(state.game.sound.context, state.position)\n    setAudioOri(state.game.sound.context, walk[state.direction])\n}\n\n// function noRecentMove(state, time) {\n//     var currTime = new Date().getTime()\n//     if (state.lastMoveTime) {\n//         if (Math.abs(currTime - state.lastMoveTime) < time) return false\n//     }\n//     state.lastMoveTime = currTime\n//     return true\n// }\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/movement.js\n **/","var map = {\"4_0_0\": {\"e\": [5, 0, 0], \"n\": [4, 1, 0], \"w\": [3, 0, 0]}, \"6_6_0\": {\"s\": [6, 5, 0], \"e\": [7, 6, 0], \"w\": [5, 6, 0]}, \"2_6_0\": {\"s\": [2, 5, 0], \"e\": [3, 6, 0]}, \"3_7_0\": {\"s\": [3, 6, 0], \"e\": [4, 7, 0]}, \"8_3_0\": {\"s\": [8, 2, 0], \"n\": [8, 4, 0]}, \"1_2_0\": {\"e\": [2, 2, 0], \"n\": [1, 3, 0], \"w\": [0, 2, 0]}, \"3_0_0\": {\"e\": [4, 0, 0], \"w\": [2, 0, 0]}, \"0_2_0\": {\"s\": [0, 1, 0], \"e\": [1, 2, 0]}, \"-1_7_0\": {\"e\": [0, 7, 0]}, \"3_4_0\": {\"e\": [4, 4, 0], \"w\": [2, 4, 0]}, \"6_7_0\": {\"e\": [7, 7, 0], \"w\": [5, 7, 0]}, \"6_4_0\": {\"s\": [6, 3, 0], \"e\": [7, 4, 0], \"n\": [6, 5, 0], \"w\": [5, 4, 0]}, \"1_8_0\": {\"s\": [1, 7, 0], \"w\": [0, 8, 0]}, \"1_0_0\": {\"n\": [1, 1, 0], \"w\": [0, 0, 0]}, \"8_6_0\": {\"s\": [8, 5, 0], \"w\": [7, 6, 0]}, \"6_3_0\": {\"s\": [6, 2, 0], \"n\": [6, 4, 0]}, \"4_4_0\": {\"s\": [4, 3, 0], \"e\": [5, 4, 0], \"n\": [4, 5, 0], \"w\": [3, 4, 0]}, \"8_8_0\": {\"s\": [8, 7, 0], \"n\": [8, 9, 0]}, \"6_5_0\": {\"s\": [6, 4, 0], \"n\": [6, 6, 0]}, \"5_1_0\": {\"s\": [5, 0, 0], \"n\": [5, 2, 0]}, \"3_2_0\": {\"s\": [3, 1, 0]}, \"0_7_0\": {\"n\": [0, 8, 0], \"w\": [-1, 7, 0]}, \"7_0_0\": {\"e\": [8, 0, 0], \"w\": [6, 0, 0]}, \"4_3_0\": {\"s\": [4, 2, 0], \"n\": [4, 4, 0]}, \"7_7_0\": {\"s\": [7, 6, 0], \"e\": [8, 7, 0], \"n\": [7, 8, 0], \"w\": [6, 7, 0]}, \"2_2_0\": {\"w\": [1, 2, 0]}, \"7_2_0\": {\"s\": [7, 1, 0], \"e\": [8, 2, 0], \"w\": [6, 2, 0]}, \"4_1_0\": {\"s\": [4, 0, 0]}, \"1_1_0\": {\"s\": [1, 0, 0], \"e\": [2, 1, 0], \"w\": [0, 1, 0]}, \"2_1_0\": {\"s\": [2, 0, 0], \"e\": [3, 1, 0], \"w\": [1, 1, 0]}, \"2_5_0\": {\"n\": [2, 6, 0], \"w\": [1, 5, 0]}, \"8_2_0\": {\"n\": [8, 3, 0], \"w\": [7, 2, 0]}, \"2_4_0\": {\"s\": [2, 3, 0], \"e\": [3, 4, 0], \"w\": [1, 4, 0]}, \"8_4_0\": {\"s\": [8, 3, 0], \"n\": [8, 5, 0], \"w\": [7, 4, 0]}, \"0_5_0\": {\"n\": [0, 6, 0]}, \"1_4_0\": {\"s\": [1, 3, 0], \"e\": [2, 4, 0], \"n\": [1, 5, 0], \"w\": [0, 4, 0]}, \"6_1_0\": {\"s\": [6, 0, 0], \"e\": [7, 1, 0]}, \"0_1_0\": {\"e\": [1, 1, 0], \"n\": [0, 2, 0]}, \"5_2_0\": {\"s\": [5, 1, 0], \"e\": [6, 2, 0], \"w\": [4, 2, 0]}, \"1_7_0\": {\"s\": [1, 6, 0], \"e\": [2, 7, 0], \"n\": [1, 8, 0]}, \"1_5_0\": {\"s\": [1, 4, 0], \"e\": [2, 5, 0]}, \"2_3_0\": {\"n\": [2, 4, 0], \"w\": [1, 3, 0]}, \"3_6_0\": {\"n\": [3, 7, 0], \"w\": [2, 6, 0]}, \"4_6_0\": {\"s\": [4, 5, 0], \"n\": [4, 7, 0]}, \"0_8_0\": {\"s\": [0, 7, 0], \"e\": [1, 8, 0]}, \"5_7_0\": {\"e\": [6, 7, 0], \"w\": [4, 7, 0]}, \"9_0_0\": {\"w\": [8, 0, 0]}, \"3_1_0\": {\"n\": [3, 2, 0], \"w\": [2, 1, 0]}, \"8_9_0\": {\"s\": [8, 8, 0]}, \"4_8_0\": {\"e\": [5, 8, 0], \"w\": [3, 8, 0]}, \"5_4_0\": {\"e\": [6, 4, 0], \"w\": [4, 4, 0]}, \"0_0_0\": {\"s\": [0, -1, 0], \"e\": [1, 0, 0]}, \"4_2_0\": {\"e\": [5, 2, 0], \"n\": [4, 3, 0]}, \"3_8_0\": {\"e\": [4, 8, 0], \"w\": [2, 8, 0]}, \"5_0_0\": {\"n\": [5, 1, 0], \"w\": [4, 0, 0]}, \"7_6_0\": {\"e\": [8, 6, 0], \"n\": [7, 7, 0], \"w\": [6, 6, 0]}, \"2_8_0\": {\"s\": [2, 7, 0], \"e\": [3, 8, 0]}, \"8_7_0\": {\"n\": [8, 8, 0], \"w\": [7, 7, 0]}, \"2_7_0\": {\"n\": [2, 8, 0], \"w\": [1, 7, 0]}, \"0_-1_0\": {\"n\": [0, 0, 0]}, \"0_4_0\": {\"s\": [0, 3, 0], \"e\": [1, 4, 0]}, \"6_0_0\": {\"e\": [7, 0, 0], \"n\": [6, 1, 0]}, \"4_7_0\": {\"s\": [4, 6, 0], \"e\": [5, 7, 0], \"w\": [3, 7, 0]}, \"7_4_0\": {\"e\": [8, 4, 0], \"w\": [6, 4, 0]}, \"1_6_0\": {\"n\": [1, 7, 0], \"w\": [0, 6, 0]}, \"6_2_0\": {\"e\": [7, 2, 0], \"n\": [6, 3, 0], \"w\": [5, 2, 0]}, \"5_8_0\": {\"e\": [6, 8, 0], \"w\": [4, 8, 0]}, \"0_3_0\": {\"e\": [1, 3, 0], \"n\": [0, 4, 0]}, \"2_0_0\": {\"e\": [3, 0, 0], \"n\": [2, 1, 0]}, \"5_6_0\": {\"e\": [6, 6, 0]}, \"7_8_0\": {\"s\": [7, 7, 0], \"w\": [6, 8, 0]}, \"8_1_0\": {\"w\": [7, 1, 0]}, \"4_5_0\": {\"s\": [4, 4, 0], \"n\": [4, 6, 0]}, \"0_6_0\": {\"s\": [0, 5, 0], \"e\": [1, 6, 0]}, \"8_0_0\": {\"e\": [9, 0, 0], \"w\": [7, 0, 0]}, \"8_5_0\": {\"s\": [8, 4, 0], \"n\": [8, 6, 0]}, \"1_3_0\": {\"s\": [1, 2, 0], \"e\": [2, 3, 0], \"n\": [1, 4, 0], \"w\": [0, 3, 0]}, \"7_1_0\": {\"e\": [8, 1, 0], \"n\": [7, 2, 0], \"w\": [6, 1, 0]}, \"6_8_0\": {\"e\": [7, 8, 0], \"w\": [5, 8, 0]}}\nexport default map\n\n\n\n/** WEBPACK FOOTER **\n ** ./assets/map/map.js\n **/","import {getBounds} from './utils.js'\nimport {state} from './store.js'\n\n\nexport function initKeyboardInput(fMove, fInteract) {\n    var cursors = ['UP', 'DOWN', 'LEFT', 'RIGHT']\n    cursors.map(\n        (key) => state.game.input.keyboard.addKey(\n            Phaser.Keyboard[key]).onDown.add(fMove, this, null, key))\n\n    state.game.input.keyboard.addKey(\n        Phaser.Keyboard.SPACEBAR).onDown.add(fInteract, this, null)\n}\n\nexport function initMouseInput(fMove, fInteract) {\n    state.onTap = (manager, pointer) => onTap(pointer, fMove, fInteract)\n}\n\nfunction onTap(pointer, fMove, fInteract) {\n    var x = pointer.x\n    var y = pointer.y\n\n    // The image is divided in 5 areas: top, bottom, left, right and\n    // center. A bigger p makes the center smaller and the other areas\n    // bigger but more narrow.\n    var p = 0.28\n    var [ix, iy, iw, ih] = getBounds(state.img)\n    var ty = iy + ih * p\n    var by = iy + ih * (1-p)\n    var lx = ix + iw * p\n    var rx = ix + iw * (1-p)\n    // var area = null\n\n    // Left, Right or Middle\n    if (y > ty && y < by) {\n        if (x < lx) fMove(null, 'LEFT') //area = 'left'\n        else if (x > rx) fMove(null, 'RIGHT') //area = 'right'\n        else fInteract() //area = 'center'\n        // Tor or Bottom\n    } else if (x > lx && x < rx) {\n        if (y < ty) fMove(null, 'UP') //area = 'top'\n        else if (y > by) fMove(null, 'DOWN') //area = 'bottom'\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/input.js\n **/","import {randInt} from './utils.js'\nimport {hideInterface, openPage} from './interface.js'\nimport {addEffect, loadVision} from './vision.js'\nimport {randomizePresencePositions} from './randPos.js'\nimport {changeDarkPresencePos, initPlayerPos} from './movement.js'\nimport {createPositionedAudios} from './createAudios.js'\nimport {touchedDarkPresence, stopSong, playSong, playButtonSound} from './game.js'\nimport {state} from './store.js'\n\nimport {setListenerPos} from './audio.js'\nimport {tweenPos} from './movement.js'\n\n\nvar darkPresencePhrases = [\n    'Raaaaarrrrr!!!!',\n    'Embrace Darkness!',\n    \"You can't win!\",\n    \"You can't hide!\",\n    \"You can't escape!\",\n    \"You are doomed!\",\n    'I found you.',\n    'Again?',\n    'Run faster next time.',\n    'Muhahahahah!',\n    'Unstoppable!',\n]\n\n\nfunction fadeGame(fadeTime=2000) {\n    state.state = 'finished'\n    addEffect(state, 0x000000, 1)\n    state.effect.alpha = 0\n    state.game.add.tween(state.effect)\n        .to({alpha: 1}, fadeTime, \"Linear\", true)\n}\n\n\nfunction wonLevel1() {\n    state.game.createdSounds.harp.play()\n    playSong('song')\n    fadeGame()\n    openPage('end1', false)\n}\n\nfunction introLevel1() {\n    if (state.playIntro) openPage('controls')\n    else startLevel()\n}\n\nfunction introLevel2() {\n    localStorage.lastLevel = 1\n    if (state.playIntro) {\n        hideInterface()\n        stopSong(1000)\n        state.game.createdSounds.darkSpell.play()\n        state.game.createdSounds.darkSpell.onStop.add(\n            function () {\n                state.game.createdSounds.darkSpell.onStop.removeAll()\n                randomizePresencePositions(state.position)\n                openPage('l2intro', false)\n                playSong('darkSong', 1000)\n            }\n        )\n    } else {\n        randomizePresencePositions(state.position)\n        startLevel()\n    }\n}\n\nfunction fadeOutPositionalSounds() {\n    // Move player up so should not hear positional sounds.\n    var oldPos = state.position\n    var posSetter = (pos) => setListenerPos(state.game.sound.context, pos)\n    tweenPos(oldPos, [oldPos[0], oldPos[1], 10], posSetter, 1000, state, 'Move')\n}\n\nfunction wonLevel2() {\n    state.state = 'finished'\n    fadeOutPositionalSounds()\n    state.game.createdSounds.end2.play()\n    state.game.createdSounds.end2.onStop.add(\n        function() {\n            state.game.createdSounds.end2.onStop.removeAll()\n            fadeGame(1000)\n            openPage('l2end1', false)\n            playSong('song')\n        }\n    )\n}\n\nfunction lostLevel2() {\n    state.game.createdSounds.rarr.play()\n    fadeGame(1000)\n    state.playIntro = false\n    openPage('lost2', false,\n             darkPresencePhrases[randInt(darkPresencePhrases.length)])\n    // game.sound.masterGain\n    fadeOutPositionalSounds()\n}\n\nfunction loadLevel(n) {\n    state.level = n\n    state.position = [4, 4, 0]\n    state.followed = []\n    state.power = []\n    // loadVision(state)\n    if (n == 1) {\n        randomizePresencePositions(state.position)\n        state.won = wonLevel1\n        state.intro = introLevel1\n        state.tint = 0xffffff\n        state.filters = []\n        state.onMoved = null\n    } else if (n == 2) {\n        state.won = wonLevel2\n        state.lost = lostLevel2\n        state.intro = introLevel2\n        state.tint = 0x202020\n        state.filters = [state.game.createdFilters.gray]\n        state.onMoved = () => changeDarkPresencePos(state.position,\n                                                    touchedDarkPresence)\n    }\n}\n\nexport function startLevel() {\n    hideInterface()\n    initPlayerPos()\n    createPositionedAudios()\n    state.state = 'starting'\n    loadVision(state)\n}\n\nexport function pickLevel(n, playSound=true) {\n    loadLevel(n)\n    state.intro()\n    if(playSound) playButtonSound()\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/levels.js\n **/","import {posDirToText} from './utils.js'\nimport {move, initPlayerPos} from './movement.js'\nimport {hideLoadingScreen, openPage} from './interface.js'\nimport {initKeyboardInput, initMouseInput} from './input.js'\nimport {createCommonAudios} from './createAudios.js'\nimport {shrines, state} from './store.js'\nimport {interact, playButtonSound, onSetVision} from './game.js'\nimport {resize} from './vision.js'\nimport {pickLevel, startLevel} from './levels.js'\n\n\nexport function mainLoad() {\n    state.game.load.onLoadComplete.add(function () {\n            state.game.load.onLoadComplete.removeAll()\n            mainInit()\n    }, this)\n\n    state.game.load.audio('button', ['assets/audio/button.ogg'])\n    state.game.load.audio('stream', ['assets/audio/stream_cold.ogg'])\n    state.game.load.audio('wind', ['assets/audio/wind.ogg'])\n    state.game.load.audio('fire', ['assets/audio/fire.ogg'])\n    state.game.load.audio('earth', ['assets/audio/earth.ogg'])\n    state.game.load.audio('magic', ['assets/audio/magic_slow.ogg'])\n    state.game.load.audio('magic_request', ['assets/audio/magic_request.ogg'])\n    state.game.load.audio('magic_arrived', ['assets/audio/magic_arrived.ogg'])\n    state.game.load.audio('magic_no', ['assets/audio/magic_no.ogg'])\n    state.game.load.audio('harp', ['assets/audio/harp.ogg'])\n    state.game.load.audio('harp_start', ['assets/audio/harp_start.ogg'])\n    state.game.load.audio('steps', ['assets/audio/steps.ogg'])\n    state.game.load.audio('dark_spell', ['assets/audio/dark_spell.ogg'])\n    state.game.load.audio('dark_presence', ['assets/audio/dark_presence.ogg'])\n    state.game.load.audio('dark_song', ['assets/audio/dark_song.ogg'])\n    state.game.load.audio('rarr', ['assets/audio/rarr.ogg'])\n    state.game.load.audio('end2', ['assets/audio/end2.ogg'])\n\n    state.game.load.script(\n        'gray',\n        'https://cdn.rawgit.com/photonstorm/phaser/master/filters/Gray.js')\n\n    var firstImg = posDirToText(state.position, state.direction)\n    state.game.load.image(firstImg, `assets/map/${firstImg}.jpg`)\n\n    state.game.load.start()\n    console.log('Loading...')\n}\n\n// First init called. Should be called only once, and before any level.\nfunction mainInit() {\n    console.log('Done loading')\n    hideLoadingScreen()\n\n    state.game.stage.backgroundColor = '#000000'\n    // Used to render some things always in front of others\n    state.layers = {\n        back: state.game.add.group(),\n        front: state.game.add.group(),\n    }\n\n    state.onSetVision = onSetVision\n    resize()\n\n    // initialize state presences (needed to later randomize them)\n    for (let k in shrines) {\n        state.presences[k] = {}\n    }\n\n    state.game.createdFilters = {gray: state.game.add.filter('Gray')}\n    createCommonAudios()\n    initKeyboardInput(move, interact)\n    initMouseInput(move, interact)\n\n    if (!localStorage.getItem('lastLevel')) {\n        // No level unlocked\n        pickLevel(1, false)\n    } else {\n        // Level 2 unlocked\n        openPage('mainmenu', false)\n    }\n}\n\n// Exported functions, so interface can call them\nwindow.playButtonSound = playButtonSound\nwindow.pickLevel = pickLevel\nwindow.startLevel = startLevel\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/loader.js\n **/","import map from '../assets/map/map.js'\nimport {randInt, textToPos, posToText} from './utils.js'\nimport {shrines, state} from './store.js'\n\n\nexport function randomizePresencePositions(player_pos) {\n    let possible_pos = {}\n    var array_pos = []\n\n    // No presence arrived yet\n    for (let p in state.presences) state.presences[p].arrived = false\n\n    // copy all map positions\n    for (let k in map) possible_pos[k] = true\n\n    // remove positions too close to player position\n    deleteCube(possible_pos, player_pos, 1)\n\n    // remove positions too close to shrines\n    for (let k in shrines) {\n        deleteCube(possible_pos, shrines[k].position, 2)\n    }\n\n    // place the dark presence\n    if (state.level == 2) {\n        array_pos = Object.keys(possible_pos)\n        state.darkPresence.position = textToPos(array_pos[randInt(array_pos.length)])\n    } else {\n        state.darkPresence.position = [100,100,100]\n    }\n\n    // place presences\n    // Placing presences may fail for when one is placed, the others\n    // have less space to be placed. Try again sometimes if failed.\n    var failed = false\n    var remainingAttempts = 10\n    do {\n        let remaining_pos = Object.assign({}, possible_pos)\n        for (let k in shrines) {\n            // convert to array so can random pick an index\n            array_pos = Object.keys(remaining_pos)\n            // check if still has positions to use\n            if (!array_pos.length) {\n                // no positions left, try again?\n                failed = true\n                console.log('ops...')\n            } else {\n                // random choice\n                var pos = textToPos(array_pos[randInt(array_pos.length)])\n                // set presence to pos\n                state.presences[k].position = pos\n                // remove positions too close to presence\n                deleteCube(remaining_pos, pos, 2)\n            }\n        }\n        remainingAttempts--\n    } while (failed && remainingAttempts)\n\n    if (failed) {\n        console.log('OMG! I failed! =O')\n    }\n}\n\nfunction deleteCube(obj, center, radius) {\n    var [xc, yc, zc] = center\n    for (let i=xc-radius; xc+radius>=i; i++) {\n        for (let j=yc-radius; yc+radius>=j; j++) {\n            for (let k=zc-radius; zc+radius>=k; k++) {\n                delete obj[posToText([i, j, k])]\n            }\n        }\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/randPos.js\n **/","module.exports = \"<p>But here comes the tricky part: you can't see the presences. You can only hear them.\\n    And that is also how you'll need to find out which presence belongs to which shrine.</p>\\n<p>One last tip: once you gain the power to communicate with a presence, you lose the power to communicate with the others.</p>\\n<a onClick=\\\"window.openPage('instructions')\\\">Back</a>\\n<a onClick=\\\"window.startLevel()\\\">Ok! Here I go!</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/cantsee.html\n ** module id = 57\n ** module chunks = 1\n **/","module.exports = \"<p>In this game you will need to be guided by sounds. So a headphone is <b>highly</b> recommended.</p>\\n<p>It's also <b>highly</b> recommended to play it using a recent Firefox or Chromium/Chrome. Firefox seems to play the sounds better.</p>\\n<p>Use the <b>arrow keys</b> to walk and the <b>spacebar</b> to interact.\\nOr click or touch the top/bottom parts of the screen to walk forward/backward and the left/right to rotate. Click/tap the middle of the screen to interact.</p>\\n<a onClick=\\\"window.openPage('instrorstart')\\\">Ok</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/controls.html\n ** module id = 58\n ** module chunks = 1\n **/","module.exports = \"<p>This is a free software game!</p>\\n<p>Made by: Andrés M. R. Martano</p>\\n<p>Based on works from many others.</p>\\n\\n<ul>\\n  <li>\\n    <a href=\\\"https://github.com/andresmrm/labyrimental\\\" target=\\\"_blank\\\">Check full credits and source repository.</a>\\n  </li>\\n  <li>\\n    <a onClick=\\\"window.openPage('mainmenu')\\\">Main menu</a>\\n  </li>\\n<ul>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/credits.html\n ** module id = 59\n ** module chunks = 1\n **/","module.exports = \"<p>Wow! Congratulations!</p>\\n<p>You helped the presenses! They are very grateful!</p>\\n<a onClick=\\\"window.pickLevel(2)\\\">Yay!</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/end1.html\n ** module id = 60\n ** module chunks = 1\n **/","module.exports = \"<p>This magic labyrinth has four elemental shrines, each inhabited by an elemental presence.\\nA powerfull spell casted nearby shaked the land, confusing the presences and spreading them around the labyrinth. Now they need your help to guide them back to their shrines.</p>\\n<a onClick=\\\"window.openPage('instructions')\\\">Next</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/history.html\n ** module id = 61\n ** module chunks = 1\n **/","module.exports = \"<p>Do you want to read the instructions or find out how to play by yourself?</p>\\n<a onClick=\\\"window.openPage('history')\\\">I don't want to guess how to play this weird game. Show me the instructions.</a>\\n<a onClick=\\\"window.startLevel()\\\">Challenge is my second name. Just start the game.</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/instrorstart.html\n ** module id = 62\n ** module chunks = 1\n **/","module.exports = \"<p>Before you can help one of the presences, you need to visit her shrine. There you will gain the power to communicate with her. After that you need to find the presence around the labyrinth, stay very close and interact, calling her to follow you. Then you can bring her back to her shrine.</p>\\n<a onClick=\\\"window.openPage('history')\\\">Back</a>\\n<a onClick=\\\"window.openPage('cantsee')\\\">Next</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/instructions.html\n ** module id = 63\n ** module chunks = 1\n **/","module.exports = \"<p>We did it! United the elemental presences could communicate with the dark presence and lessen her anger.</p>\\n<a onClick=\\\"window.openPage('l2end2')\\\">Great!</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2end1.html\n ** module id = 64\n ** module chunks = 1\n **/","module.exports = \"<p>It seems she's angry because of the powerfull spells casted and she thought you're the one responsible for them.</p>\\n<p>Maybe it's time to find out who is behind all this...</p>\\n<a onClick=\\\"window.openPage('l2end3')\\\">...</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2end2.html\n ** module id = 65\n ** module chunks = 1\n **/","module.exports = \"<p>Continue?</p>\\n<a onClick=\\\"window.openPage('credits')\\\">End</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2end3.html\n ** module id = 66\n ** module chunks = 1\n **/","module.exports = \"<p>Uh oh...</p>\\n<a onClick=\\\"window.openPage('l2intro2')\\\">WHAT WAS THAT?</a>\\n<a onClick=\\\"window.openPage('l2intro2')\\\">Not again...</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2intro.html\n ** module id = 67\n ** module chunks = 1\n **/","module.exports = \"<p>It seems a powerfull spell was casted again. But this time, it unleashed a... dark presence.</p>\\n<p>What are we going to do now?</p>\\n<a onClick=\\\"window.openPage('l2intro3')\\\">Hey! You're the one supposed to tell me that!</a>\\n<a onClick=\\\"window.startLevel()\\\">Just stay out of the way and I'll solve it quick.</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2intro2.html\n ** module id = 68\n ** module chunks = 1\n **/","module.exports = \"<p>Hum... Ok... Don't panic.</p>\\n<p>After the powerfull spell was casted again, the four elemental presences should be spread across the labyrinth once again. But maybe, if you can unite them, they can do something about it.</p>\\n<a onClick=\\\"window.openPage('l2intro3a')\\\">They can't even find the way back to their shines!</a>\\n<a onClick=\\\"window.openPage('l2intro4')\\\">Ok...</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2intro3.html\n ** module id = 69\n ** module chunks = 1\n **/","module.exports = \"<p>Hey! Don't underestimate the presences! Besides, I have no other idea...</p>\\n<a onClick=\\\"window.openPage('l2intro4')\\\">Great...</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2intro3a.html\n ** module id = 70\n ** module chunks = 1\n **/","module.exports = \"<p>Ok, so first you'll need to enter each of the four shines again, to gain the hability to communicate with each presence. This time, given the circustances, you should be able to accumulate the power to communicate with all of them at the same time. Then find them around the labyrinth.</p>\\n<a onClick=\\\"window.openPage('l2intro5')\\\">...</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2intro4.html\n ** module id = 71\n ** module chunks = 1\n **/","module.exports = \"<p>Be cautious: don't face the dark presence before you have all the four elemental presences with you. Like the others, you can't see the dark presence, but I'm sure you'll know when she is close. Run. And don't forget: she can pass through walls and she seems ANGRY.</p>\\n<a onClick=\\\"window.startLevel()\\\">...</a>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/l2intro5.html\n ** module id = 72\n ** module chunks = 1\n **/","module.exports = \"<p>{{}}</p>\\n<ul>\\n  <li>\\n    <a onClick=\\\"window.pickLevel(2)\\\">Restart</a>\\n  </li>\\n  <li>\\n    <a onClick=\\\"window.openPage('mainmenu')\\\">Main menu</a>\\n  </li>\\n<ul>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/lost2.html\n ** module id = 73\n ** module chunks = 1\n **/","module.exports = \"<p>Select a level:</p>\\n<ul>\\n  <li>\\n    <a onClick=\\\"window.pickLevel(1)\\\">Level 1</a>\\n  </li>\\n  <li>\\n    <a onClick=\\\"window.pickLevel(2)\\\">Level 2</a>\\n  </li>\\n<ul>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/text-loader!./src/pages/mainmenu.html\n ** module id = 74\n ** module chunks = 1\n **/"],"sourceRoot":""}